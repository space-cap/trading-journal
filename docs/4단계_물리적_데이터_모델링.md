# 4ë‹¨ê³„: ë¬¼ë¦¬ì  ë°ì´í„° ëª¨ë¸ë§

## ğŸ“‹ ë¬¸ì„œ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **í”„ë¡œì íŠ¸ëª…** | Trading Journal (ë§¤ë§¤ ì¼ì§€ ê´€ë¦¬ ì‹œìŠ¤í…œ) |
| **ì‘ì„±ì¼** | 2025-11-23 |
| **ì‘ì„±ì** | Database Design Team |
| **ë¬¸ì„œ ë²„ì „** | 1.0 |
| **ë¬¸ì„œ ëª©ì ** | DBMS íŠ¹í™” ë¬¼ë¦¬ì  ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ì„¤ê³„ ë° ìµœì í™” |
| **ì„ í–‰ ë¬¸ì„œ** | [3ë‹¨ê³„_ë…¼ë¦¬ì _ë°ì´í„°_ëª¨ë¸ë§.md](file:///c:/workdir/space-cap/trading-journal/docs/3ë‹¨ê³„_ë…¼ë¦¬ì _ë°ì´í„°_ëª¨ë¸ë§.md) |

---

## 1. ë¬¼ë¦¬ì  ëª¨ë¸ë§ ê°œìš”

### 1.1 ë¬¼ë¦¬ì  ëª¨ë¸ë§ì˜ ëª©ì 

ë¬¼ë¦¬ì  ë°ì´í„° ëª¨ë¸ë§ì€ ë…¼ë¦¬ì  ëª¨ë¸ì„ **íŠ¹ì • DBMSì— ìµœì í™”**í•˜ì—¬ ì‹¤ì œ êµ¬í˜„ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë³€í™˜í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.

**ì£¼ìš” ëª©í‘œ**:
- DBMS ì„ ì • ë° ë²„ì „ ê²°ì •
- ë¬¼ë¦¬ì  DDL ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- ìŠ¤í† ë¦¬ì§€ ì—”ì§„ ë° í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ì„¤ê³„
- ì¸ë±ìŠ¤ ë¬¼ë¦¬ì  êµ¬ì¡° ìµœì í™”
- íŒŒí‹°ì…”ë‹ ì „ëµ ìˆ˜ë¦½
- ì„±ëŠ¥ íŠœë‹ ë° ì¿¼ë¦¬ ìµœì í™”
- ë°±ì—…/ë³µêµ¬ ì „ëµ ìˆ˜ë¦½

### 1.2 DBMS ì„ ì •

#### ê°œë°œ í™˜ê²½: H2 Database

| í•­ëª© | ë‚´ìš© |
|------|------|
| **DBMS** | H2 Database |
| **ë²„ì „** | 2.2.x |
| **ë¼ì´ì„ ìŠ¤** | MPL 2.0 / EPL 1.0 |
| **ì„ ì • ê·¼ê±°** | - ì¸ë©”ëª¨ë¦¬ DBë¡œ ë¹ ë¥¸ ê°œë°œ<br>- ì„¤ì • ë¶ˆí•„ìš”<br>- Spring Boot ê¸°ë³¸ ì§€ì›<br>- íŒŒì¼ ê¸°ë°˜ ì˜ì†ì„± ì§€ì› |
| **ì œì•½ì‚¬í•­** | - í”„ë¡œë•ì…˜ ì‚¬ìš© ë¶€ì í•©<br>- ë™ì‹œ ì ‘ì† ì œí•œ<br>- ì¼ë¶€ ê³ ê¸‰ ê¸°ëŠ¥ ë¯¸ì§€ì› |

#### ìš´ì˜ í™˜ê²½: MySQL

| í•­ëª© | ë‚´ìš© |
|------|------|
| **DBMS** | MySQL |
| **ë²„ì „** | 8.0.x (LTS) |
| **ìŠ¤í† ë¦¬ì§€ ì—”ì§„** | InnoDB |
| **ë¼ì´ì„ ìŠ¤** | GPL 2.0 |
| **ì„ ì • ê·¼ê±°** | - ì˜¤í”ˆì†ŒìŠ¤, ë¬´ë£Œ<br>- ë†’ì€ ì•ˆì •ì„± ë° ì„±ëŠ¥<br>- í’ë¶€í•œ ì»¤ë®¤ë‹ˆí‹°<br>- Spring Boot ì™„ë²½ ì§€ì›<br>- í´ë¼ìš°ë“œ í˜¸ìŠ¤íŒ… ìš©ì´ |
| **ëŒ€ì•ˆ** | PostgreSQL (í–¥í›„ ê³ ë ¤) |

---

## 2. ë¬¼ë¦¬ì  í…Œì´ë¸” ì„¤ê³„

### 2.1 trades í…Œì´ë¸” ë¬¼ë¦¬ì  DDL (MySQL)

```sql
-- ============================================
-- í…Œì´ë¸”: trades
-- ì„¤ëª…: ì£¼ì‹ ë§¤ë§¤ ê±°ë˜ ê¸°ë¡
-- ìŠ¤í† ë¦¬ì§€ ì—”ì§„: InnoDB
-- ë¬¸ìì…‹: utf8mb4 (ì´ëª¨ì§€ ì§€ì›)
-- ì½œë ˆì´ì…˜: utf8mb4_unicode_ci
-- ============================================

CREATE TABLE trades (
    -- ê¸°ë³¸í‚¤
    trade_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ë§¤ë§¤ ê³ ìœ  ì‹ë³„ì',
    
    -- ë§¤ë§¤ ì •ë³´
    symbol VARCHAR(20) NOT NULL COMMENT 'ì¢…ëª© ì½”ë“œ (ì˜ˆ: 005930, AAPL)',
    entry_price DECIMAL(15,2) NOT NULL COMMENT 'ì§„ì… ê°€ê²© (ë§¤ìˆ˜ ì²´ê²°ê°€)',
    quantity INT UNSIGNED NOT NULL COMMENT 'ìˆ˜ëŸ‰ (ì£¼ì‹ ìˆ˜)',
    fee DECIMAL(10,2) UNSIGNED NOT NULL DEFAULT 0.00 COMMENT 'ê±°ë˜ ìˆ˜ìˆ˜ë£Œ',
    reason VARCHAR(500) NOT NULL COMMENT 'ë§¤ë§¤ ê·¼ê±° ë° ì „ëµ',
    entry_date DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'ì§„ì… ì¼ì‹œ (ë°€ë¦¬ì´ˆ í¬í•¨)',
    
    -- ì²­ì‚° ì •ë³´ (ì„ íƒ)
    exit_price DECIMAL(15,2) NULL COMMENT 'ì²­ì‚° ê°€ê²© (ë§¤ë„ ì²´ê²°ê°€)',
    exit_date DATETIME(3) NULL COMMENT 'ì²­ì‚° ì¼ì‹œ (ë°€ë¦¬ì´ˆ í¬í•¨)',
    
    -- ë©”íƒ€ë°ì´í„°
    created_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'ë ˆì½”ë“œ ìƒì„± ì¼ì‹œ',
    updated_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'ë ˆì½”ë“œ ìˆ˜ì • ì¼ì‹œ',
    deleted_at DATETIME(3) NULL COMMENT 'ë…¼ë¦¬ ì‚­ì œ ì¼ì‹œ (Soft Delete)',
    
    -- ì œì•½ì¡°ê±´
    CONSTRAINT pk_trades PRIMARY KEY (trade_id),
    CONSTRAINT chk_trades_entry_price CHECK (entry_price > 0),
    CONSTRAINT chk_trades_quantity CHECK (quantity > 0),
    CONSTRAINT chk_trades_fee CHECK (fee >= 0),
    CONSTRAINT chk_trades_exit_price CHECK (exit_price IS NULL OR exit_price > 0),
    CONSTRAINT chk_trades_exit_date CHECK (exit_date IS NULL OR exit_date > entry_date),
    CONSTRAINT chk_trades_symbol_length CHECK (CHAR_LENGTH(symbol) > 0),
    CONSTRAINT chk_trades_reason_length CHECK (CHAR_LENGTH(reason) > 0),
    CONSTRAINT chk_trades_exit_consistency CHECK (
        (exit_price IS NULL AND exit_date IS NULL) OR
        (exit_price IS NOT NULL AND exit_date IS NOT NULL)
    ),
    
    -- ì¸ë±ìŠ¤
    INDEX idx_trades_symbol (symbol) COMMENT 'ì¢…ëª©ë³„ ì¡°íšŒ',
    INDEX idx_trades_entry_date (entry_date) COMMENT 'ê¸°ê°„ë³„ ì¡°íšŒ',
    INDEX idx_trades_deleted_at (deleted_at) COMMENT 'ë…¼ë¦¬ ì‚­ì œ í•„í„°ë§',
    INDEX idx_trades_symbol_entry_date (symbol, entry_date) COMMENT 'ì¢…ëª©+ê¸°ê°„ ë³µí•© ì¡°íšŒ',
    INDEX idx_trades_exit_price (exit_price) COMMENT 'ì²­ì‚° ì—¬ë¶€ ì¡°íšŒ'
    
) ENGINE=InnoDB 
  DEFAULT CHARSET=utf8mb4 
  COLLATE=utf8mb4_unicode_ci 
  COMMENT='ì£¼ì‹ ë§¤ë§¤ ê±°ë˜ ê¸°ë¡ í…Œì´ë¸”'
  ROW_FORMAT=DYNAMIC;
```

### 2.2 trades í…Œì´ë¸” ë¬¼ë¦¬ì  DDL (H2)

```sql
-- ============================================
-- í…Œì´ë¸”: trades (H2 Database)
-- ì„¤ëª…: ì£¼ì‹ ë§¤ë§¤ ê±°ë˜ ê¸°ë¡
-- ============================================

CREATE TABLE trades (
    trade_id BIGINT NOT NULL AUTO_INCREMENT,
    symbol VARCHAR(20) NOT NULL,
    entry_price DECIMAL(15,2) NOT NULL,
    quantity INT NOT NULL,
    fee DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    reason VARCHAR(500) NOT NULL,
    entry_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    exit_price DECIMAL(15,2) NULL,
    exit_date TIMESTAMP NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    CONSTRAINT pk_trades PRIMARY KEY (trade_id),
    CONSTRAINT chk_trades_entry_price CHECK (entry_price > 0),
    CONSTRAINT chk_trades_quantity CHECK (quantity > 0),
    CONSTRAINT chk_trades_fee CHECK (fee >= 0),
    CONSTRAINT chk_trades_exit_price CHECK (exit_price IS NULL OR exit_price > 0),
    CONSTRAINT chk_trades_exit_date CHECK (exit_date IS NULL OR exit_date > entry_date),
    CONSTRAINT chk_trades_symbol_length CHECK (LENGTH(symbol) > 0),
    CONSTRAINT chk_trades_reason_length CHECK (LENGTH(reason) > 0)
);

CREATE INDEX idx_trades_symbol ON trades(symbol);
CREATE INDEX idx_trades_entry_date ON trades(entry_date);
CREATE INDEX idx_trades_deleted_at ON trades(deleted_at);
CREATE INDEX idx_trades_symbol_entry_date ON trades(symbol, entry_date);
```

### 2.3 users í…Œì´ë¸” ë¬¼ë¦¬ì  DDL (MySQL)

```sql
-- ============================================
-- í…Œì´ë¸”: users (Phase 2)
-- ì„¤ëª…: ì‹œìŠ¤í…œ ì‚¬ìš©ì ê³„ì •
-- ============================================

CREATE TABLE users (
    user_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ì‚¬ìš©ì ê³ ìœ  ì‹ë³„ì',
    email VARCHAR(100) NOT NULL COMMENT 'ì´ë©”ì¼ ì£¼ì†Œ (ë¡œê·¸ì¸ ID)',
    password VARCHAR(255) NOT NULL COMMENT 'ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ (BCrypt)',
    name VARCHAR(50) NOT NULL COMMENT 'ì‚¬ìš©ì ì´ë¦„',
    joined_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'ê°€ì… ì¼ì‹œ',
    last_login_at DATETIME(3) NULL COMMENT 'ìµœê·¼ ë¡œê·¸ì¸ ì¼ì‹œ',
    created_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'ë ˆì½”ë“œ ìƒì„± ì¼ì‹œ',
    updated_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'ë ˆì½”ë“œ ìˆ˜ì • ì¼ì‹œ',
    deleted_at DATETIME(3) NULL COMMENT 'ë…¼ë¦¬ ì‚­ì œ ì¼ì‹œ',
    
    CONSTRAINT pk_users PRIMARY KEY (user_id),
    CONSTRAINT uk_users_email UNIQUE (email),
    CONSTRAINT chk_users_email_format CHECK (email LIKE '%@%'),
    CONSTRAINT chk_users_name_length CHECK (CHAR_LENGTH(name) > 0)
    
) ENGINE=InnoDB 
  DEFAULT CHARSET=utf8mb4 
  COLLATE=utf8mb4_unicode_ci 
  COMMENT='ì‹œìŠ¤í…œ ì‚¬ìš©ì ê³„ì • í…Œì´ë¸”'
  ROW_FORMAT=DYNAMIC;
```

### 2.4 Phase 2: trades í…Œì´ë¸” ì™¸ë˜í‚¤ ì¶”ê°€

```sql
-- ============================================
-- ì™¸ë˜í‚¤ ì¶”ê°€: trades.user_id â†’ users.user_id
-- ============================================

ALTER TABLE trades 
ADD COLUMN user_id BIGINT UNSIGNED NOT NULL COMMENT 'ì‚¬ìš©ì ID (ì™¸ë˜í‚¤)' 
AFTER trade_id;

ALTER TABLE trades
ADD CONSTRAINT fk_trades_user 
    FOREIGN KEY (user_id) 
    REFERENCES users(user_id)
    ON DELETE RESTRICT
    ON UPDATE CASCADE;

CREATE INDEX idx_trades_user_id ON trades(user_id);
```

---

## 3. ë°ì´í„° íƒ€ì… ë§¤í•‘

### 3.1 ë…¼ë¦¬ì  íƒ€ì… â†’ MySQL ë¬¼ë¦¬ì  íƒ€ì…

| ë…¼ë¦¬ì  íƒ€ì… | MySQL íƒ€ì… | í¬ê¸° | ì„¤ëª… |
|-----------|-----------|------|------|
| **ID** | BIGINT UNSIGNED | 8 bytes | 0 ~ 18,446,744,073,709,551,615 |
| **ì¢…ëª©ì½”ë“œ** | VARCHAR(20) | ê°€ë³€ | ìµœëŒ€ 20ì, utf8mb4 |
| **ê°€ê²©** | DECIMAL(15,2) | 7 bytes | ì •ë°€ë„ 15ìë¦¬, ì†Œìˆ˜ì  2ìë¦¬ |
| **ìˆ˜ëŸ‰** | INT UNSIGNED | 4 bytes | 0 ~ 4,294,967,295 |
| **ìˆ˜ìˆ˜ë£Œ** | DECIMAL(10,2) UNSIGNED | 6 bytes | 0 ì´ìƒ, ì†Œìˆ˜ì  2ìë¦¬ |
| **í…ìŠ¤íŠ¸_ì¤‘ê°„** | VARCHAR(500) | ê°€ë³€ | ìµœëŒ€ 500ì |
| **ì¼ì‹œ** | DATETIME(3) | 5 bytes | ë°€ë¦¬ì´ˆ ì •ë°€ë„ |
| **ì´ë©”ì¼** | VARCHAR(100) | ê°€ë³€ | ìµœëŒ€ 100ì |
| **ë¹„ë°€ë²ˆí˜¸** | VARCHAR(255) | ê°€ë³€ | BCrypt í•´ì‹œ ì €ì¥ |

### 3.2 ë…¼ë¦¬ì  íƒ€ì… â†’ H2 ë¬¼ë¦¬ì  íƒ€ì…

| ë…¼ë¦¬ì  íƒ€ì… | H2 íƒ€ì… | ì„¤ëª… |
|-----------|--------|------|
| **ID** | BIGINT | -9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807 |
| **ì¢…ëª©ì½”ë“œ** | VARCHAR(20) | ìµœëŒ€ 20ì |
| **ê°€ê²©** | DECIMAL(15,2) | ì •ë°€ë„ 15ìë¦¬, ì†Œìˆ˜ì  2ìë¦¬ |
| **ìˆ˜ëŸ‰** | INT | -2,147,483,648 ~ 2,147,483,647 |
| **ìˆ˜ìˆ˜ë£Œ** | DECIMAL(10,2) | ì†Œìˆ˜ì  2ìë¦¬ |
| **í…ìŠ¤íŠ¸_ì¤‘ê°„** | VARCHAR(500) | ìµœëŒ€ 500ì |
| **ì¼ì‹œ** | TIMESTAMP | ë‚˜ë…¸ì´ˆ ì •ë°€ë„ |

---

## 4. ì¸ë±ìŠ¤ ë¬¼ë¦¬ì  ì„¤ê³„

### 4.1 ì¸ë±ìŠ¤ íƒ€ì… ì„ íƒ

#### MySQL InnoDB ì¸ë±ìŠ¤ íŠ¹ì„±

| ì¸ë±ìŠ¤ íƒ€ì… | ì„¤ëª… | ì‚¬ìš© ì‚¬ë¡€ |
|-----------|------|----------|
| **B-Tree (ê¸°ë³¸)** | ê· í˜• íŠ¸ë¦¬ êµ¬ì¡° | ë²”ìœ„ ê²€ìƒ‰, ì •ë ¬, ëŒ€ë¶€ë¶„ì˜ ì¿¼ë¦¬ |
| **Hash** | í•´ì‹œ í…Œì´ë¸” | ì •í™•í•œ ì¼ì¹˜ ê²€ìƒ‰ (InnoDBëŠ” ë‚´ë¶€ì ìœ¼ë¡œë§Œ ì‚¬ìš©) |
| **Full-Text** | ì „ë¬¸ ê²€ìƒ‰ | í…ìŠ¤íŠ¸ ê²€ìƒ‰ (reason ì»¬ëŸ¼ì— ì ìš© ê°€ëŠ¥) |
| **Spatial** | ê³µê°„ ì¸ë±ìŠ¤ | ì§€ë¦¬ ì •ë³´ (ë¯¸ì‚¬ìš©) |

#### í´ëŸ¬ìŠ¤í„°ë“œ vs ë…¼í´ëŸ¬ìŠ¤í„°ë“œ ì¸ë±ìŠ¤

| êµ¬ë¶„ | í´ëŸ¬ìŠ¤í„°ë“œ ì¸ë±ìŠ¤ | ë…¼í´ëŸ¬ìŠ¤í„°ë“œ ì¸ë±ìŠ¤ |
|------|----------------|------------------|
| **ê°œìˆ˜** | í…Œì´ë¸”ë‹¹ 1ê°œ | í…Œì´ë¸”ë‹¹ ì—¬ëŸ¬ ê°œ |
| **êµ¬ì¡°** | ë°ì´í„°ê°€ ì¸ë±ìŠ¤ ìˆœì„œë¡œ ì €ì¥ | ë³„ë„ì˜ ì¸ë±ìŠ¤ êµ¬ì¡° |
| **InnoDB** | PRIMARY KEY | ë‚˜ë¨¸ì§€ ëª¨ë“  ì¸ë±ìŠ¤ |
| **ì„±ëŠ¥** | ë²”ìœ„ ê²€ìƒ‰ ë¹ ë¦„ | í¬ì¸í„° ì°¸ì¡° í•„ìš” |

### 4.2 trades í…Œì´ë¸” ì¸ë±ìŠ¤ ìƒì„¸

#### ì¸ë±ìŠ¤ 1: pk_trades (í´ëŸ¬ìŠ¤í„°ë“œ)

```sql
PRIMARY KEY (trade_id)
```

**íŠ¹ì„±**:
- **íƒ€ì…**: B-Tree í´ëŸ¬ìŠ¤í„°ë“œ ì¸ë±ìŠ¤
- **ì •ë ¬**: ASC (ì˜¤ë¦„ì°¨ìˆœ)
- **ì¹´ë””ë„ë¦¬í‹°**: ë§¤ìš° ë†’ìŒ (ê³ ìœ ê°’)
- **ì„ íƒë„**: 100% (ëª¨ë“  ê°’ì´ ê³ ìœ )

**ì‚¬ìš© ì¿¼ë¦¬**:
```sql
SELECT * FROM trades WHERE trade_id = 123;
SELECT * FROM trades WHERE trade_id BETWEEN 100 AND 200;
```

#### ì¸ë±ìŠ¤ 2: idx_trades_symbol

```sql
CREATE INDEX idx_trades_symbol ON trades(symbol);
```

**íŠ¹ì„±**:
- **íƒ€ì…**: B-Tree ë…¼í´ëŸ¬ìŠ¤í„°ë“œ ì¸ë±ìŠ¤
- **ì¹´ë””ë„ë¦¬í‹°**: ì¤‘ê°„ (ì¢…ëª© ìˆ˜ì— ë”°ë¼ ë‹¤ë¦„)
- **ì„ íƒë„**: ì¤‘ê°„ (ì¢…ëª©ë‹¹ ì—¬ëŸ¬ ë§¤ë§¤)

**ì‚¬ìš© ì¿¼ë¦¬**:
```sql
SELECT * FROM trades WHERE symbol = 'AAPL';
SELECT COUNT(*) FROM trades WHERE symbol = '005930';
```

**ì˜ˆìƒ ì„±ëŠ¥**:
- ë ˆì½”ë“œ ìˆ˜: 10,000ê±´
- ì¢…ëª© ìˆ˜: 100ê°œ
- í‰ê·  ì¢…ëª©ë‹¹ ë§¤ë§¤: 100ê±´
- ì¸ë±ìŠ¤ ìŠ¤ìº”: O(log N) = O(log 10,000) â‰ˆ 13íšŒ ë¹„êµ

#### ì¸ë±ìŠ¤ 3: idx_trades_entry_date

```sql
CREATE INDEX idx_trades_entry_date ON trades(entry_date);
```

**íŠ¹ì„±**:
- **íƒ€ì…**: B-Tree ë…¼í´ëŸ¬ìŠ¤í„°ë“œ ì¸ë±ìŠ¤
- **ì¹´ë””ë„ë¦¬í‹°**: ë†’ìŒ (ì¼ì‹œëŠ” ê±°ì˜ ê³ ìœ )
- **ì„ íƒë„**: ë†’ìŒ

**ì‚¬ìš© ì¿¼ë¦¬**:
```sql
SELECT * FROM trades 
WHERE entry_date BETWEEN '2024-01-01' AND '2024-01-31';

SELECT * FROM trades 
WHERE entry_date >= '2024-01-01'
ORDER BY entry_date DESC;
```

#### ì¸ë±ìŠ¤ 4: idx_trades_symbol_entry_date (ë³µí•©)

```sql
CREATE INDEX idx_trades_symbol_entry_date ON trades(symbol, entry_date);
```

**íŠ¹ì„±**:
- **íƒ€ì…**: B-Tree ë³µí•© ì¸ë±ìŠ¤
- **ì»¬ëŸ¼ ìˆœì„œ**: symbol (ì„ íƒë„ ì¤‘ê°„) â†’ entry_date (ì„ íƒë„ ë†’ìŒ)
- **ì»¤ë²„ë§ ì¸ë±ìŠ¤**: ê°€ëŠ¥ (symbol, entry_dateë§Œ ì¡°íšŒ ì‹œ)

**ì‚¬ìš© ì¿¼ë¦¬**:
```sql
SELECT * FROM trades 
WHERE symbol = 'AAPL' 
  AND entry_date BETWEEN '2024-01-01' AND '2024-01-31';

SELECT symbol, entry_date FROM trades 
WHERE symbol = 'TSLA'
ORDER BY entry_date DESC;
```

**ì¸ë±ìŠ¤ í™œìš© ê·œì¹™**:
- âœ… `WHERE symbol = ? AND entry_date = ?` â†’ ì¸ë±ìŠ¤ ì™„ì „ í™œìš©
- âœ… `WHERE symbol = ?` â†’ ì¸ë±ìŠ¤ ë¶€ë¶„ í™œìš© (ì„ í–‰ ì»¬ëŸ¼)
- âŒ `WHERE entry_date = ?` â†’ ì¸ë±ìŠ¤ ë¯¸í™œìš© (í›„í–‰ ì»¬ëŸ¼ë§Œ ì‚¬ìš©)

#### ì¸ë±ìŠ¤ 5: idx_trades_deleted_at

```sql
CREATE INDEX idx_trades_deleted_at ON trades(deleted_at);
```

**íŠ¹ì„±**:
- **íƒ€ì…**: B-Tree ë…¼í´ëŸ¬ìŠ¤í„°ë“œ ì¸ë±ìŠ¤
- **ì¹´ë””ë„ë¦¬í‹°**: ë‚®ìŒ (ëŒ€ë¶€ë¶„ NULL)
- **ì„ íƒë„**: ë‚®ìŒ

**ì‚¬ìš© ì¿¼ë¦¬**:
```sql
SELECT * FROM trades WHERE deleted_at IS NULL;
SELECT * FROM trades WHERE deleted_at IS NOT NULL;
```

**ìµœì í™” ê³ ë ¤**:
- NULL ê°’ì´ ëŒ€ë¶€ë¶„ì´ë¯€ë¡œ ì¸ë±ìŠ¤ íš¨ìœ¨ì´ ë‚®ì„ ìˆ˜ ìˆìŒ
- ë¶€ë¶„ ì¸ë±ìŠ¤ (Partial Index) ê³ ë ¤ (MySQL 8.0.13+)

```sql
CREATE INDEX idx_trades_active ON trades(trade_id) 
WHERE deleted_at IS NULL;
```

### 4.3 ì¸ë±ìŠ¤ í¬ê¸° ì¶”ì •

#### trades í…Œì´ë¸” (10,000 ë ˆì½”ë“œ ê¸°ì¤€)

| ì¸ë±ìŠ¤ | ì»¬ëŸ¼ í¬ê¸° | ë ˆì½”ë“œ ìˆ˜ | ì˜ˆìƒ í¬ê¸° |
|-------|---------|----------|----------|
| **pk_trades** | 8 bytes | 10,000 | ~80 KB |
| **idx_trades_symbol** | 20 bytes | 10,000 | ~200 KB |
| **idx_trades_entry_date** | 5 bytes | 10,000 | ~50 KB |
| **idx_trades_symbol_entry_date** | 25 bytes | 10,000 | ~250 KB |
| **idx_trades_deleted_at** | 5 bytes | 10,000 | ~50 KB |
| **í•©ê³„** | - | - | **~630 KB** |

---

## 5. íŒŒí‹°ì…”ë‹ ì „ëµ

### 5.1 íŒŒí‹°ì…”ë‹ ê°œìš”

íŒŒí‹°ì…”ë‹ì€ ëŒ€ìš©ëŸ‰ í…Œì´ë¸”ì„ ë…¼ë¦¬ì ìœ¼ë¡œëŠ” í•˜ë‚˜ì˜ í…Œì´ë¸”ë¡œ, ë¬¼ë¦¬ì ìœ¼ë¡œëŠ” ì—¬ëŸ¬ ê°œì˜ ì‘ì€ í…Œì´ë¸”ë¡œ ë¶„í• í•˜ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤.

**ì¥ì **:
- ì¿¼ë¦¬ ì„±ëŠ¥ í–¥ìƒ (íŒŒí‹°ì…˜ í”„ë£¨ë‹)
- ê´€ë¦¬ ìš©ì´ì„± (íŒŒí‹°ì…˜ë³„ ë°±ì—…/ë³µêµ¬)
- ë³‘ë ¬ ì²˜ë¦¬ ê°€ëŠ¥

**ë‹¨ì **:
- ê´€ë¦¬ ë³µì¡ë„ ì¦ê°€
- ì¼ë¶€ ì¿¼ë¦¬ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥

### 5.2 trades í…Œì´ë¸” íŒŒí‹°ì…”ë‹ ì „ëµ

#### íŒŒí‹°ì…”ë‹ íƒ€ì… ì„ íƒ

| íƒ€ì… | ì„¤ëª… | ì í•©ì„± |
|------|------|--------|
| **Range** | ë²”ìœ„ ê¸°ë°˜ ë¶„í•  | âœ… ì¶”ì²œ (entry_date ê¸°ì¤€) |
| **List** | ëª©ë¡ ê¸°ë°˜ ë¶„í•  | âŒ ë¶€ì í•© |
| **Hash** | í•´ì‹œ ê¸°ë°˜ ë¶„í•  | âš ï¸ ê°€ëŠ¥ (ê· ë“± ë¶„ì‚°) |
| **Key** | í‚¤ ê¸°ë°˜ ë¶„í•  | âš ï¸ ê°€ëŠ¥ |

#### Range Partitioning (ì—°ë„ë³„)

```sql
-- ============================================
-- Range Partitioning by Year
-- ============================================

CREATE TABLE trades (
    trade_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    symbol VARCHAR(20) NOT NULL,
    entry_price DECIMAL(15,2) NOT NULL,
    quantity INT UNSIGNED NOT NULL,
    fee DECIMAL(10,2) UNSIGNED NOT NULL DEFAULT 0.00,
    reason VARCHAR(500) NOT NULL,
    entry_date DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
    exit_price DECIMAL(15,2) NULL,
    exit_date DATETIME(3) NULL,
    created_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
    updated_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),
    deleted_at DATETIME(3) NULL,
    
    PRIMARY KEY (trade_id, entry_date),  -- íŒŒí‹°ì…˜ í‚¤ í¬í•¨ í•„ìˆ˜
    INDEX idx_trades_symbol (symbol),
    INDEX idx_trades_entry_date (entry_date)
    
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci
  PARTITION BY RANGE (YEAR(entry_date)) (
      PARTITION p2024 VALUES LESS THAN (2025),
      PARTITION p2025 VALUES LESS THAN (2026),
      PARTITION p2026 VALUES LESS THAN (2027),
      PARTITION p2027 VALUES LESS THAN (2028),
      PARTITION p_future VALUES LESS THAN MAXVALUE
  );
```

**íŒŒí‹°ì…˜ í”„ë£¨ë‹ ì˜ˆì‹œ**:
```sql
-- 2024ë…„ ë°ì´í„°ë§Œ ìŠ¤ìº” (p2024 íŒŒí‹°ì…˜ë§Œ ì ‘ê·¼)
SELECT * FROM trades 
WHERE entry_date BETWEEN '2024-01-01' AND '2024-12-31';

-- ëª¨ë“  íŒŒí‹°ì…˜ ìŠ¤ìº” (íŒŒí‹°ì…˜ í‚¤ ë¯¸ì‚¬ìš©)
SELECT * FROM trades WHERE symbol = 'AAPL';
```

### 5.3 íŒŒí‹°ì…”ë‹ ì ìš© ì‹œì 

| ì¡°ê±´ | í˜„ì¬ ìƒíƒœ | ê¶Œì¥ ì‚¬í•­ |
|------|----------|----------|
| **ë ˆì½”ë“œ ìˆ˜** | < 10,000 | âŒ íŒŒí‹°ì…”ë‹ ë¶ˆí•„ìš” |
| **ë ˆì½”ë“œ ìˆ˜** | 100,000 ~ 1,000,000 | âš ï¸ íŒŒí‹°ì…”ë‹ ê³ ë ¤ |
| **ë ˆì½”ë“œ ìˆ˜** | > 1,000,000 | âœ… íŒŒí‹°ì…”ë‹ ê¶Œì¥ |

**ê²°ë¡ **: Phase 1ì—ì„œëŠ” íŒŒí‹°ì…”ë‹ì„ ì ìš©í•˜ì§€ ì•Šê³ , ë°ì´í„°ê°€ 100ë§Œ ê±´ ì´ìƒ ì¦ê°€ ì‹œ ì ìš©

---

## 6. ìŠ¤í† ë¦¬ì§€ ì„¤ê³„

### 6.1 MySQL InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ ì„¤ì •

#### í…Œì´ë¸” ìŠ¤í˜ì´ìŠ¤

```sql
-- ì‹œìŠ¤í…œ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ (ê¸°ë³¸)
-- íŒŒì¼: ibdata1

-- íŒŒì¼ë³„ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ (ê¶Œì¥)
-- íŒŒì¼: trades.ibd, users.ibd
SET GLOBAL innodb_file_per_table = ON;
```

**ì¥ì **:
- í…Œì´ë¸”ë³„ ë…ë¦½ì ì¸ íŒŒì¼ ê´€ë¦¬
- DROP TABLE ì‹œ ë””ìŠ¤í¬ ê³µê°„ ì¦‰ì‹œ ë°˜í™˜
- í…Œì´ë¸”ë³„ ë°±ì—…/ë³µêµ¬ ìš©ì´

#### ROW_FORMAT

```sql
ROW_FORMAT=DYNAMIC
```

**íŠ¹ì„±**:
- VARCHAR, TEXT, BLOBì˜ ê¸´ ê°’ì„ ì™¸ë¶€ í˜ì´ì§€ì— ì €ì¥
- ì¸ë±ìŠ¤ í‚¤ ê¸¸ì´ ì œí•œ: 3072 bytes
- ì••ì¶• ì§€ì›

**ëŒ€ì•ˆ**:
- `COMPACT`: ê¸°ë³¸ í˜•ì‹, ê³µê°„ íš¨ìœ¨ì 
- `COMPRESSED`: ì••ì¶• ì €ì¥ (CPU ì‚¬ìš© ì¦ê°€)

### 6.2 ë””ìŠ¤í¬ ìš©ëŸ‰ ì‚°ì •

#### trades í…Œì´ë¸” ë ˆì½”ë“œ í¬ê¸°

| ì»¬ëŸ¼ | íƒ€ì… | í¬ê¸° (bytes) |
|------|------|-------------|
| trade_id | BIGINT UNSIGNED | 8 |
| symbol | VARCHAR(20) | 20 + 2 (ê¸¸ì´) |
| entry_price | DECIMAL(15,2) | 7 |
| quantity | INT UNSIGNED | 4 |
| fee | DECIMAL(10,2) | 6 |
| reason | VARCHAR(500) | 500 + 2 (í‰ê· ) |
| entry_date | DATETIME(3) | 5 |
| exit_price | DECIMAL(15,2) | 7 |
| exit_date | DATETIME(3) | 5 |
| created_at | DATETIME(3) | 5 |
| updated_at | DATETIME(3) | 5 |
| deleted_at | DATETIME(3) | 5 |
| **í•©ê³„** | - | **~581 bytes** |

#### ìš©ëŸ‰ ì¶”ì • (3ë…„ ê¸°ì¤€)

| í•­ëª© | ê°’ |
|------|-----|
| **ì—°ê°„ ë ˆì½”ë“œ ìˆ˜** | 240ê±´ (1ì¸ ê¸°ì¤€) |
| **3ë…„ ë ˆì½”ë“œ ìˆ˜** | 720ê±´ |
| **ë ˆì½”ë“œë‹¹ í¬ê¸°** | 581 bytes |
| **ë°ì´í„° í¬ê¸°** | 720 Ã— 581 â‰ˆ 418 KB |
| **ì¸ë±ìŠ¤ í¬ê¸°** | ~630 KB (10,000ê±´ ê¸°ì¤€ ë¹„ìœ¨ ì ìš©) |
| **ì˜¤ë²„í—¤ë“œ (30%)** | ~315 KB |
| **ì´ ì˜ˆìƒ í¬ê¸°** | **~1.4 MB** |

#### í™•ì¥ ì‹œë‚˜ë¦¬ì˜¤ (1,000 ì‚¬ìš©ì, 3ë…„)

| í•­ëª© | ê°’ |
|------|-----|
| **ì´ ë ˆì½”ë“œ ìˆ˜** | 720,000ê±´ |
| **ë°ì´í„° í¬ê¸°** | ~418 MB |
| **ì¸ë±ìŠ¤ í¬ê¸°** | ~630 MB |
| **ì˜¤ë²„í—¤ë“œ** | ~315 MB |
| **ì´ ì˜ˆìƒ í¬ê¸°** | **~1.4 GB** |

---

## 7. ì„±ëŠ¥ íŠœë‹

### 7.1 ì¿¼ë¦¬ ìµœì í™”

#### ì¿¼ë¦¬ 1: ì „ì²´ ë§¤ë§¤ ì¡°íšŒ (í™œì„±ë§Œ)

**ë¹„íš¨ìœ¨ì ì¸ ì¿¼ë¦¬**:
```sql
SELECT * FROM trades WHERE deleted_at IS NULL;
```

**ìµœì í™”ëœ ì¿¼ë¦¬**:
```sql
-- í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¡°íšŒ
SELECT trade_id, symbol, entry_price, quantity, entry_date, exit_price
FROM trades 
WHERE deleted_at IS NULL
ORDER BY entry_date DESC
LIMIT 100;
```

**ì‹¤í–‰ ê³„íš**:
```sql
EXPLAIN SELECT trade_id, symbol, entry_price, quantity, entry_date, exit_price
FROM trades 
WHERE deleted_at IS NULL
ORDER BY entry_date DESC
LIMIT 100;
```

#### ì¿¼ë¦¬ 2: ì†ìµ ê³„ì‚° (ì²­ì‚° ì™„ë£Œ)

**ë¹„íš¨ìœ¨ì ì¸ ì¿¼ë¦¬**:
```sql
SELECT *,
    (exit_price * quantity) - (entry_price * quantity) - fee AS realized_pnl
FROM trades
WHERE exit_price IS NOT NULL;
```

**ìµœì í™”ëœ ì¿¼ë¦¬**:
```sql
-- ì»¤ë²„ë§ ì¸ë±ìŠ¤ í™œìš©
SELECT trade_id, symbol, entry_price, exit_price, quantity, fee,
    (exit_price * quantity) - (entry_price * quantity) - fee AS realized_pnl
FROM trades
WHERE exit_price IS NOT NULL
  AND deleted_at IS NULL;

-- ì»¤ë²„ë§ ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_trades_pnl_covering 
ON trades(exit_price, trade_id, symbol, entry_price, quantity, fee, deleted_at);
```

#### ì¿¼ë¦¬ 3: ì¢…ëª©ë³„ í†µê³„

**ë¹„íš¨ìœ¨ì ì¸ ì¿¼ë¦¬**:
```sql
SELECT symbol, COUNT(*) as trade_count
FROM trades
GROUP BY symbol;
```

**ìµœì í™”ëœ ì¿¼ë¦¬**:
```sql
-- í™œì„± ë§¤ë§¤ë§Œ, ì¸ë±ìŠ¤ í™œìš©
SELECT symbol, COUNT(*) as trade_count
FROM trades
WHERE deleted_at IS NULL
GROUP BY symbol
ORDER BY trade_count DESC;
```

### 7.2 MySQL ì„¤ì • ìµœì í™”

#### my.cnf (ë˜ëŠ” my.ini) ì„¤ì •

```ini
[mysqld]
# InnoDB ë²„í¼ í’€ í¬ê¸° (ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ì˜ 70-80%)
innodb_buffer_pool_size = 1G

# InnoDB ë¡œê·¸ íŒŒì¼ í¬ê¸°
innodb_log_file_size = 256M

# ì¿¼ë¦¬ ìºì‹œ (MySQL 8.0ì—ì„œ ì œê±°ë¨)
# query_cache_type = 1
# query_cache_size = 64M

# ìµœëŒ€ ì—°ê²° ìˆ˜
max_connections = 200

# í…Œì´ë¸” ì˜¤í”ˆ ìºì‹œ
table_open_cache = 2000

# ì„ì‹œ í…Œì´ë¸” í¬ê¸°
tmp_table_size = 64M
max_heap_table_size = 64M

# ì •ë ¬ ë²„í¼
sort_buffer_size = 2M

# ì¡°ì¸ ë²„í¼
join_buffer_size = 2M

# ìŠ¬ë¡œìš° ì¿¼ë¦¬ ë¡œê·¸
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow-query.log
long_query_time = 2

# ë°”ì´ë„ˆë¦¬ ë¡œê·¸ (ë³µì œ ë° ë°±ì—…ìš©)
log_bin = /var/log/mysql/mysql-bin.log
binlog_format = ROW
expire_logs_days = 7
```

### 7.3 ì‹¤í–‰ ê³„íš ë¶„ì„

#### EXPLAIN ì‚¬ìš©ë²•

```sql
EXPLAIN SELECT * FROM trades WHERE symbol = 'AAPL';
```

**ì£¼ìš” ì»¬ëŸ¼ í•´ì„**:

| ì»¬ëŸ¼ | ì˜ë¯¸ | ì¢‹ì€ ê°’ |
|------|------|--------|
| **type** | ì¡°ì¸ íƒ€ì… | const, eq_ref, ref |
| **possible_keys** | ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ë±ìŠ¤ | ì¸ë±ìŠ¤ ì¡´ì¬ |
| **key** | ì‹¤ì œ ì‚¬ìš©ëœ ì¸ë±ìŠ¤ | ì¸ë±ìŠ¤ ì‚¬ìš© |
| **rows** | ì˜ˆìƒ ìŠ¤ìº” í–‰ ìˆ˜ | ì ì„ìˆ˜ë¡ ì¢‹ìŒ |
| **Extra** | ì¶”ê°€ ì •ë³´ | Using index (ì»¤ë²„ë§) |

**ë‚˜ìœ ì‹¤í–‰ ê³„íš ì˜ˆì‹œ**:
```
type: ALL (ì „ì²´ í…Œì´ë¸” ìŠ¤ìº”)
key: NULL (ì¸ë±ìŠ¤ ë¯¸ì‚¬ìš©)
rows: 10000 (ë§ì€ í–‰ ìŠ¤ìº”)
Extra: Using filesort (íŒŒì¼ ì •ë ¬)
```

---

## 8. ë°±ì—… ë° ë³µêµ¬ ì „ëµ

### 8.1 ë°±ì—… ì „ëµ

#### ë°±ì—… íƒ€ì…

| ë°±ì—… íƒ€ì… | ì„¤ëª… | ì£¼ê¸° | ë„êµ¬ |
|----------|------|------|------|
| **ì „ì²´ ë°±ì—…** | ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ | ì£¼ 1íšŒ (ì¼ìš”ì¼) | mysqldump, Percona XtraBackup |
| **ì¦ë¶„ ë°±ì—…** | ë³€ê²½ëœ ë°ì´í„°ë§Œ | ì¼ 1íšŒ | Binary Log |
| **ë…¼ë¦¬ì  ë°±ì—…** | SQL ë¤í”„ | ì£¼ 1íšŒ | mysqldump |
| **ë¬¼ë¦¬ì  ë°±ì—…** | ë°ì´í„° íŒŒì¼ ë³µì‚¬ | ì¼ 1íšŒ | Percona XtraBackup |

#### ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ (mysqldump)

```bash
#!/bin/bash
# backup_trading_journal.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup/mysql"
DB_NAME="trading_journal"
DB_USER="backup_user"
DB_PASS="secure_password"

# ì „ì²´ ë°±ì—…
mysqldump -u $DB_USER -p$DB_PASS \
    --single-transaction \
    --routines \
    --triggers \
    --events \
    $DB_NAME > $BACKUP_DIR/trading_journal_$DATE.sql

# ì••ì¶•
gzip $BACKUP_DIR/trading_journal_$DATE.sql

# 7ì¼ ì´ìƒ ëœ ë°±ì—… ì‚­ì œ
find $BACKUP_DIR -name "trading_journal_*.sql.gz" -mtime +7 -delete

echo "Backup completed: trading_journal_$DATE.sql.gz"
```

#### Cron ì„¤ì • (ë§¤ì¼ ìƒˆë²½ 2ì‹œ)

```cron
0 2 * * * /usr/local/bin/backup_trading_journal.sh >> /var/log/backup.log 2>&1
```

### 8.2 ë³µêµ¬ ì „ëµ

#### ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤

| ì‹œë‚˜ë¦¬ì˜¤ | ë³µêµ¬ ë°©ë²• | RTO | RPO |
|---------|----------|-----|-----|
| **í…Œì´ë¸” ì‚­ì œ** | ìµœê·¼ ë°±ì—… ë³µì› | 1ì‹œê°„ | 24ì‹œê°„ |
| **ë°ì´í„° ì†ìƒ** | Binary Log ì¬ìƒ | 2ì‹œê°„ | 1ì‹œê°„ |
| **ì„œë²„ ì¥ì• ** | ìƒˆ ì„œë²„ì— ë°±ì—… ë³µì› | 4ì‹œê°„ | 24ì‹œê°„ |
| **ì‚¬ìš©ì ì‹¤ìˆ˜** | íŠ¹ì • ì‹œì  ë³µì› (PITR) | 30ë¶„ | 1ì‹œê°„ |

#### ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# restore_trading_journal.sh

BACKUP_FILE="/backup/mysql/trading_journal_20241123_020000.sql.gz"
DB_NAME="trading_journal"
DB_USER="root"
DB_PASS="root_password"

# ì••ì¶• í•´ì œ ë° ë³µì›
gunzip < $BACKUP_FILE | mysql -u $DB_USER -p$DB_PASS $DB_NAME

echo "Restore completed from $BACKUP_FILE"
```

#### Point-in-Time Recovery (PITR)

```bash
# 1. ìµœê·¼ ì „ì²´ ë°±ì—… ë³µì›
mysql -u root -p trading_journal < trading_journal_20241123_020000.sql

# 2. Binary Log ì¬ìƒ (íŠ¹ì • ì‹œì ê¹Œì§€)
mysqlbinlog --stop-datetime="2024-11-23 14:30:00" \
    /var/log/mysql/mysql-bin.000001 \
    /var/log/mysql/mysql-bin.000002 \
    | mysql -u root -p trading_journal
```

### 8.3 ì¬í•´ ë³µêµ¬ ê³„íš (DRP)

#### ë³µêµ¬ ëª©í‘œ

| í•­ëª© | ëª©í‘œ |
|------|------|
| **RTO (Recovery Time Objective)** | 4ì‹œê°„ |
| **RPO (Recovery Point Objective)** | 24ì‹œê°„ |
| **ë°ì´í„° ì†ì‹¤ í—ˆìš©** | ìµœëŒ€ 1ì¼ì¹˜ |

#### ë³µêµ¬ ì ˆì°¨

1. **ì¥ì•  ê°ì§€** (5ë¶„)
   - ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì•Œë¦¼
   - ì¥ì•  ìœ í˜• íŒŒì•…

2. **ë°±ì—… ì„œë²„ ì¤€ë¹„** (30ë¶„)
   - ìƒˆ MySQL ì„œë²„ ì„¤ì¹˜
   - ë„¤íŠ¸ì›Œí¬ ì„¤ì •

3. **ë°ì´í„° ë³µì›** (2ì‹œê°„)
   - ìµœê·¼ ë°±ì—… ë³µì›
   - Binary Log ì¬ìƒ

4. **ê²€ì¦** (1ì‹œê°„)
   - ë°ì´í„° ë¬´ê²°ì„± í™•ì¸
   - ì• í”Œë¦¬ì¼€ì´ì…˜ í…ŒìŠ¤íŠ¸

5. **ì„œë¹„ìŠ¤ ì „í™˜** (30ë¶„)
   - DNS ë³€ê²½
   - ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘

---

## 9. ëª¨ë‹ˆí„°ë§ ë° ìœ ì§€ë³´ìˆ˜

### 9.1 ëª¨ë‹ˆí„°ë§ ì§€í‘œ

#### ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ ì§€í‘œ

| ì§€í‘œ | ì„¤ëª… | ì„ê³„ê°’ |
|------|------|--------|
| **QPS (Queries Per Second)** | ì´ˆë‹¹ ì¿¼ë¦¬ ìˆ˜ | < 1,000 |
| **TPS (Transactions Per Second)** | ì´ˆë‹¹ íŠ¸ëœì­ì…˜ ìˆ˜ | < 500 |
| **Slow Query Count** | ëŠë¦° ì¿¼ë¦¬ ìˆ˜ | < 10/hour |
| **Connection Count** | ë™ì‹œ ì—°ê²° ìˆ˜ | < 100 |
| **Buffer Pool Hit Rate** | ë²„í¼ í’€ íˆíŠ¸ìœ¨ | > 95% |
| **Disk I/O** | ë””ìŠ¤í¬ ì½ê¸°/ì“°ê¸° | < 100 MB/s |

#### ëª¨ë‹ˆí„°ë§ ì¿¼ë¦¬

```sql
-- í˜„ì¬ ì—°ê²° ìˆ˜
SHOW STATUS LIKE 'Threads_connected';

-- ìŠ¬ë¡œìš° ì¿¼ë¦¬ ìˆ˜
SHOW STATUS LIKE 'Slow_queries';

-- ë²„í¼ í’€ íˆíŠ¸ìœ¨
SHOW STATUS LIKE 'Innodb_buffer_pool_read%';

-- í…Œì´ë¸” í¬ê¸°
SELECT 
    table_name,
    ROUND(((data_length + index_length) / 1024 / 1024), 2) AS size_mb
FROM information_schema.TABLES
WHERE table_schema = 'trading_journal'
ORDER BY size_mb DESC;
```

### 9.2 ì •ê¸° ìœ ì§€ë³´ìˆ˜ ì‘ì—…

#### ì£¼ê°„ ì‘ì—…

```sql
-- í…Œì´ë¸” ìµœì í™” (ë‹¨í¸í™” ì œê±°)
OPTIMIZE TABLE trades;

-- í†µê³„ ì •ë³´ ê°±ì‹ 
ANALYZE TABLE trades;

-- ì¸ë±ìŠ¤ ì¬êµ¬ì„± (í•„ìš” ì‹œ)
ALTER TABLE trades ENGINE=InnoDB;
```

#### ì›”ê°„ ì‘ì—…

- ë°±ì—… íŒŒì¼ ê²€ì¦
- ìŠ¬ë¡œìš° ì¿¼ë¦¬ ë¡œê·¸ ë¶„ì„
- ë””ìŠ¤í¬ ìš©ëŸ‰ í™•ì¸
- ì¸ë±ìŠ¤ ì‚¬ìš©ë¥  ë¶„ì„

```sql
-- ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¸ë±ìŠ¤ í™•ì¸
SELECT * FROM sys.schema_unused_indexes
WHERE object_schema = 'trading_journal';
```

---

## 10. ë³´ì•ˆ ì„¤ê³„

### 10.1 ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬

#### ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš©ì

```sql
-- ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ìš© ì‚¬ìš©ì ìƒì„±
CREATE USER 'trading_app'@'localhost' 
IDENTIFIED BY 'StrongPassword123!';

-- í•„ìš”í•œ ê¶Œí•œë§Œ ë¶€ì—¬
GRANT SELECT, INSERT, UPDATE, DELETE 
ON trading_journal.* 
TO 'trading_app'@'localhost';

-- DDL ê¶Œí•œì€ ë¶€ì—¬í•˜ì§€ ì•ŠìŒ (DROP, ALTER ë“±)
```

#### ë°±ì—… ì‚¬ìš©ì

```sql
CREATE USER 'backup_user'@'localhost' 
IDENTIFIED BY 'BackupPassword456!';

GRANT SELECT, LOCK TABLES, SHOW VIEW, EVENT, TRIGGER 
ON trading_journal.* 
TO 'backup_user'@'localhost';
```

#### ì½ê¸° ì „ìš© ì‚¬ìš©ì

```sql
CREATE USER 'readonly_user'@'%' 
IDENTIFIED BY 'ReadOnlyPassword789!';

GRANT SELECT 
ON trading_journal.* 
TO 'readonly_user'@'%';
```

### 10.2 ë°ì´í„° ì•”í˜¸í™”

#### ì „ì†¡ ì¤‘ ì•”í˜¸í™” (SSL/TLS)

```sql
-- SSL ì—°ê²° ê°•ì œ
ALTER USER 'trading_app'@'localhost' 
REQUIRE SSL;
```

#### ì €ì¥ ë°ì´í„° ì•”í˜¸í™” (At-Rest Encryption)

```sql
-- í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ì•”í˜¸í™” (MySQL 8.0+)
ALTER TABLE trades ENCRYPTION='Y';
ALTER TABLE users ENCRYPTION='Y';
```

#### ë¯¼ê° ë°ì´í„° ì•”í˜¸í™” (ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨)

```kotlin
// ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” (BCrypt)
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder

val passwordEncoder = BCryptPasswordEncoder()
val hashedPassword = passwordEncoder.encode("plainPassword")
```

### 10.3 ê°ì‚¬ ë¡œê·¸

```sql
-- ê°ì‚¬ ë¡œê·¸ í”ŒëŸ¬ê·¸ì¸ í™œì„±í™” (MySQL Enterprise)
INSTALL PLUGIN audit_log SONAME 'audit_log.so';

-- ë¡œê·¸ ëŒ€ìƒ ì„¤ì •
SET GLOBAL audit_log_policy = 'ALL';
SET GLOBAL audit_log_format = 'JSON';
```

---

## 11. ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš

### 11.1 H2 â†’ MySQL ë§ˆì´ê·¸ë ˆì´ì…˜

#### ë‹¨ê³„ 1: ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜

```sql
-- H2 ìŠ¤í‚¤ë§ˆ ë¤í”„
SCRIPT TO '/tmp/h2_schema.sql';

-- MySQLìš© ìŠ¤í‚¤ë§ˆ ë³€í™˜ (ìˆ˜ë™ ë˜ëŠ” ë„êµ¬ ì‚¬ìš©)
-- - TIMESTAMP â†’ DATETIME(3)
-- - AUTO_INCREMENT ë¬¸ë²• í™•ì¸
-- - CHECK ì œì•½ì¡°ê±´ í˜¸í™˜ì„± í™•ì¸
```

#### ë‹¨ê³„ 2: ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
# CSV ë‚´ë³´ë‚´ê¸° (H2)
SELECT * FROM trades 
INTO OUTFILE '/tmp/trades.csv' 
FIELDS TERMINATED BY ',' 
ENCLOSED BY '"';

# CSV ê°€ì ¸ì˜¤ê¸° (MySQL)
LOAD DATA INFILE '/tmp/trades.csv'
INTO TABLE trades
FIELDS TERMINATED BY ','
ENCLOSED BY '"';
```

#### ë‹¨ê³„ 3: ê²€ì¦

```sql
-- ë ˆì½”ë“œ ìˆ˜ ë¹„êµ
SELECT COUNT(*) FROM trades;  -- H2
SELECT COUNT(*) FROM trades;  -- MySQL

-- ë°ì´í„° ë¬´ê²°ì„± í™•ì¸
SELECT * FROM trades WHERE trade_id IS NULL;
SELECT * FROM trades WHERE entry_price <= 0;
```

---

## 12. í™•ì¥ ê³„íš

### 12.1 ìˆ˜ì§ í™•ì¥ (Scale-Up)

| ë¦¬ì†ŒìŠ¤ | í˜„ì¬ | í™•ì¥ í›„ |
|--------|------|--------|
| **CPU** | 2 Core | 4 Core |
| **Memory** | 4 GB | 16 GB |
| **Storage** | 50 GB SSD | 200 GB SSD |
| **innodb_buffer_pool_size** | 1 GB | 8 GB |

### 12.2 ìˆ˜í‰ í™•ì¥ (Scale-Out)

#### Read Replica êµ¬ì„±

```
[Master] (Write)
    â†“ (Replication)
[Slave 1] (Read)
[Slave 2] (Read)
```

**ì„¤ì •**:
```ini
# Master ì„¤ì •
[mysqld]
server-id = 1
log_bin = /var/log/mysql/mysql-bin.log
binlog_format = ROW

# Slave ì„¤ì •
[mysqld]
server-id = 2
relay_log = /var/log/mysql/relay-bin.log
read_only = 1
```

---

## ë¶€ë¡ A: ì „ì²´ DDL ìŠ¤í¬ë¦½íŠ¸ (MySQL)

```sql
-- ============================================
-- Trading Journal Database Schema (MySQL 8.0)
-- ============================================

-- ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
CREATE DATABASE IF NOT EXISTS trading_journal
    DEFAULT CHARACTER SET utf8mb4
    DEFAULT COLLATE utf8mb4_unicode_ci;

USE trading_journal;

-- ============================================
-- í…Œì´ë¸”: trades
-- ============================================

CREATE TABLE trades (
    trade_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ë§¤ë§¤ ê³ ìœ  ì‹ë³„ì',
    symbol VARCHAR(20) NOT NULL COMMENT 'ì¢…ëª© ì½”ë“œ',
    entry_price DECIMAL(15,2) NOT NULL COMMENT 'ì§„ì… ê°€ê²©',
    quantity INT UNSIGNED NOT NULL COMMENT 'ìˆ˜ëŸ‰',
    fee DECIMAL(10,2) UNSIGNED NOT NULL DEFAULT 0.00 COMMENT 'ìˆ˜ìˆ˜ë£Œ',
    reason VARCHAR(500) NOT NULL COMMENT 'ë§¤ë§¤ ê·¼ê±°',
    entry_date DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'ì§„ì… ì¼ì‹œ',
    exit_price DECIMAL(15,2) NULL COMMENT 'ì²­ì‚° ê°€ê²©',
    exit_date DATETIME(3) NULL COMMENT 'ì²­ì‚° ì¼ì‹œ',
    created_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'ìƒì„± ì¼ì‹œ',
    updated_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'ìˆ˜ì • ì¼ì‹œ',
    deleted_at DATETIME(3) NULL COMMENT 'ì‚­ì œ ì¼ì‹œ',
    
    CONSTRAINT pk_trades PRIMARY KEY (trade_id),
    CONSTRAINT chk_trades_entry_price CHECK (entry_price > 0),
    CONSTRAINT chk_trades_quantity CHECK (quantity > 0),
    CONSTRAINT chk_trades_fee CHECK (fee >= 0),
    CONSTRAINT chk_trades_exit_price CHECK (exit_price IS NULL OR exit_price > 0),
    CONSTRAINT chk_trades_exit_date CHECK (exit_date IS NULL OR exit_date > entry_date),
    CONSTRAINT chk_trades_symbol_length CHECK (CHAR_LENGTH(symbol) > 0),
    CONSTRAINT chk_trades_reason_length CHECK (CHAR_LENGTH(reason) > 0),
    CONSTRAINT chk_trades_exit_consistency CHECK (
        (exit_price IS NULL AND exit_date IS NULL) OR
        (exit_price IS NOT NULL AND exit_date IS NOT NULL)
    ),
    
    INDEX idx_trades_symbol (symbol) COMMENT 'ì¢…ëª©ë³„ ì¡°íšŒ',
    INDEX idx_trades_entry_date (entry_date) COMMENT 'ê¸°ê°„ë³„ ì¡°íšŒ',
    INDEX idx_trades_deleted_at (deleted_at) COMMENT 'ë…¼ë¦¬ ì‚­ì œ í•„í„°ë§',
    INDEX idx_trades_symbol_entry_date (symbol, entry_date) COMMENT 'ë³µí•© ì¡°íšŒ',
    INDEX idx_trades_exit_price (exit_price) COMMENT 'ì²­ì‚° ì—¬ë¶€ ì¡°íšŒ'
    
) ENGINE=InnoDB 
  DEFAULT CHARSET=utf8mb4 
  COLLATE=utf8mb4_unicode_ci 
  COMMENT='ì£¼ì‹ ë§¤ë§¤ ê±°ë˜ ê¸°ë¡'
  ROW_FORMAT=DYNAMIC;

-- ============================================
-- ë·°: v_active_trades
-- ============================================

CREATE VIEW v_active_trades AS
SELECT 
    trade_id,
    symbol,
    entry_price,
    quantity,
    fee,
    reason,
    entry_date,
    exit_price,
    exit_date,
    CASE 
        WHEN exit_price IS NOT NULL THEN
            (exit_price * quantity) - (entry_price * quantity) - fee
        ELSE NULL
    END AS realized_pnl,
    entry_price * quantity AS investment_amount,
    created_at,
    updated_at
FROM trades
WHERE deleted_at IS NULL;

-- ============================================
-- ë·°: v_closed_trades
-- ============================================

CREATE VIEW v_closed_trades AS
SELECT 
    trade_id,
    symbol,
    entry_price,
    quantity,
    fee,
    reason,
    entry_date,
    exit_price,
    exit_date,
    (exit_price * quantity) - (entry_price * quantity) - fee AS realized_pnl,
    entry_price * quantity AS investment_amount,
    (((exit_price * quantity) - (entry_price * quantity) - fee) / (entry_price * quantity)) * 100 AS return_rate,
    DATEDIFF(exit_date, entry_date) AS holding_days
FROM trades
WHERE deleted_at IS NULL
  AND exit_price IS NOT NULL
  AND exit_date IS NOT NULL;
```

---

## ë¶€ë¡ B: ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ì‘ì„±ì | ë³€ê²½ ë‚´ìš© |
|------|------|--------|----------|
| 1.0 | 2025-11-23 | Database Design Team | ì´ˆì•ˆ ì‘ì„± |

---

**ë¬¸ì„œ ë**
