# 3ë‹¨ê³„: ë…¼ë¦¬ì  ë°ì´í„° ëª¨ë¸ë§

## ğŸ“‹ ë¬¸ì„œ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **í”„ë¡œì íŠ¸ëª…** | Trading Journal (ë§¤ë§¤ ì¼ì§€ ê´€ë¦¬ ì‹œìŠ¤í…œ) |
| **ì‘ì„±ì¼** | 2025-11-23 |
| **ì‘ì„±ì** | Database Design Team |
| **ë¬¸ì„œ ë²„ì „** | 1.0 |
| **ë¬¸ì„œ ëª©ì ** | DBMS ë…ë¦½ì ì¸ ë…¼ë¦¬ì  ë°ì´í„° êµ¬ì¡° ì„¤ê³„ |
| **ì„ í–‰ ë¬¸ì„œ** | [2ë‹¨ê³„_ê°œë…ì _ë°ì´í„°_ëª¨ë¸ë§.md](file:///c:/workdir/space-cap/trading-journal/docs/2ë‹¨ê³„_ê°œë…ì _ë°ì´í„°_ëª¨ë¸ë§.md) |

---

## 1. ë…¼ë¦¬ì  ëª¨ë¸ë§ ê°œìš”

### 1.1 ë…¼ë¦¬ì  ëª¨ë¸ë§ì˜ ëª©ì 

ë…¼ë¦¬ì  ë°ì´í„° ëª¨ë¸ë§ì€ ê°œë…ì  ëª¨ë¸ì„ **ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°**ë¡œ ë³€í™˜í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. DBMS ì œí’ˆì— ë…ë¦½ì ì´ë©°, ì •ê·œí™”ë¥¼ í†µí•´ ë°ì´í„° ì¤‘ë³µì„ ìµœì†Œí™”í•˜ê³  ë¬´ê²°ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

**ì£¼ìš” ëª©í‘œ**:
- ì—”í‹°í‹°ë¥¼ í…Œì´ë¸”ë¡œ ë³€í™˜
- ì •ê·œí™” ì ìš© (1NF ~ BCNF)
- í‚¤(Key) ì •ì˜ (PK, FK, UK, AK)
- ë¬´ê²°ì„± ì œì•½ì¡°ê±´ ì •ì˜
- ì¸ë±ìŠ¤ ì „ëµ ìˆ˜ë¦½

### 1.2 ì •ê·œí™” ì „ëµ

Trading Journal í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒ ì •ê·œí™” ìˆ˜ì¤€ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤:

- âœ… **ì œ1ì •ê·œí˜• (1NF)**: ì›ìê°’, ë°˜ë³µ ê·¸ë£¹ ì œê±°
- âœ… **ì œ2ì •ê·œí˜• (2NF)**: ë¶€ë¶„ í•¨ìˆ˜ ì¢…ì† ì œê±°
- âœ… **ì œ3ì •ê·œí˜• (3NF)**: ì´í–‰ í•¨ìˆ˜ ì¢…ì† ì œê±°
- âœ… **BCNF**: ëª¨ë“  ê²°ì •ìê°€ í›„ë³´í‚¤
- âš ï¸ **ì œ4ì •ê·œí˜• (4NF)**: ë‹¤ì¹˜ ì¢…ì† ì œê±° (í•„ìš” ì‹œ)
- âš ï¸ **ì œ5ì •ê·œí˜• (5NF)**: ì¡°ì¸ ì¢…ì† ì œê±° (í•„ìš” ì‹œ)

> **ì°¸ê³ **: ì„±ëŠ¥ì„ ìœ„í•´ ì¼ë¶€ í…Œì´ë¸”ì€ ì˜ë„ì ìœ¼ë¡œ ë¹„ì •ê·œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (4ë‹¨ê³„ì—ì„œ ê²°ì •).

---

## 2. í…Œì´ë¸” ì„¤ê³„

### 2.1 í…Œì´ë¸” ëª©ë¡

| í…Œì´ë¸”ëª… (ì˜ë¬¸) | í…Œì´ë¸”ëª… (í•œê¸€) | ì„¤ëª… | Phase |
|---------------|---------------|------|-------|
| **trades** | ë§¤ë§¤ | ì£¼ì‹ ë§¤ë§¤ ê±°ë˜ ê¸°ë¡ | Phase 1 âœ… |
| **users** | ì‚¬ìš©ì | ì‹œìŠ¤í…œ ì‚¬ìš©ì ê³„ì • | Phase 2 â³ |
| **portfolios** | í¬íŠ¸í´ë¦¬ì˜¤ | ë§¤ë§¤ ê·¸ë£¹í™” | Phase 3 â³ |
| **tags** | íƒœê·¸ | ë§¤ë§¤ ë¶„ë¥˜ íƒœê·¸ | Phase 3 â³ |
| **trade_tags** | ë§¤ë§¤-íƒœê·¸ ì—°ê²° | N:M ê´€ê³„ í•´ì†Œ | Phase 3 â³ |
| **attachments** | ì²¨ë¶€íŒŒì¼ | ì°¨íŠ¸ ì´ë¯¸ì§€ ë“± | Phase 3 â³ |

### 2.2 Phase 1: trades í…Œì´ë¸” ìƒì„¸ ì„¤ê³„

#### 2.2.1 í…Œì´ë¸” ë©”íƒ€ë°ì´í„°

| í•­ëª© | ë‚´ìš© |
|------|------|
| **í…Œì´ë¸”ëª…** | trades |
| **í…Œì´ë¸” ì„¤ëª…** | íˆ¬ììì˜ ì£¼ì‹ ë§¤ë§¤ ê±°ë˜ ê¸°ë¡ |
| **ê¸°ë³¸í‚¤** | trade_id |
| **ì™¸ë˜í‚¤** | ì—†ìŒ (Phase 1) |
| **ì˜ˆìƒ ë ˆì½”ë“œ ìˆ˜** | 240ê±´/ë…„ (1ì¸ ê¸°ì¤€) |
| **ì„±ì¥ë¥ ** | ì—° 20% |
| **íŒŒí‹°ì…”ë‹** | ì—°ë„ë³„ Range Partitioning (í–¥í›„) |

#### 2.2.2 ì»¬ëŸ¼ ì •ì˜

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|-------|-----------|------|--------|---------|------|
| **trade_id** | BIGINT | NOT NULL | AUTO_INCREMENT | PK | ë§¤ë§¤ ê³ ìœ  ì‹ë³„ì |
| **symbol** | VARCHAR(20) | NOT NULL | - | CHECK (LENGTH(symbol) > 0) | ì¢…ëª© ì½”ë“œ |
| **entry_price** | DECIMAL(15,2) | NOT NULL | - | CHECK (entry_price > 0) | ì§„ì… ê°€ê²© |
| **quantity** | INT | NOT NULL | - | CHECK (quantity > 0) | ìˆ˜ëŸ‰ |
| **fee** | DECIMAL(10,2) | NOT NULL | 0.00 | CHECK (fee >= 0) | ìˆ˜ìˆ˜ë£Œ |
| **reason** | VARCHAR(500) | NOT NULL | - | CHECK (LENGTH(reason) > 0) | ë§¤ë§¤ ê·¼ê±° |
| **entry_date** | DATETIME | NOT NULL | CURRENT_TIMESTAMP | - | ì§„ì… ì¼ì‹œ |
| **exit_price** | DECIMAL(15,2) | NULL | NULL | CHECK (exit_price > 0 OR exit_price IS NULL) | ì²­ì‚° ê°€ê²© |
| **exit_date** | DATETIME | NULL | NULL | CHECK (exit_date > entry_date OR exit_date IS NULL) | ì²­ì‚° ì¼ì‹œ |
| **created_at** | DATETIME | NOT NULL | CURRENT_TIMESTAMP | - | ë ˆì½”ë“œ ìƒì„± ì¼ì‹œ |
| **updated_at** | DATETIME | NOT NULL | CURRENT_TIMESTAMP ON UPDATE | - | ë ˆì½”ë“œ ìˆ˜ì • ì¼ì‹œ |
| **deleted_at** | DATETIME | NULL | NULL | - | ë…¼ë¦¬ ì‚­ì œ ì¼ì‹œ |

#### 2.2.3 ì •ê·œí™” ê²€ì¦

**ì œ1ì •ê·œí˜• (1NF) ê²€ì¦**:
- âœ… ëª¨ë“  ì»¬ëŸ¼ì´ ì›ìê°’ (Atomic Value)
- âœ… ë°˜ë³µ ê·¸ë£¹ ì—†ìŒ
- âœ… ê° í–‰ì´ ê³ ìœ í•˜ê²Œ ì‹ë³„ë¨ (trade_id)

**ì œ2ì •ê·œí˜• (2NF) ê²€ì¦**:
- âœ… ê¸°ë³¸í‚¤ê°€ ë‹¨ì¼ ì»¬ëŸ¼ (trade_id)ì´ë¯€ë¡œ ë¶€ë¶„ í•¨ìˆ˜ ì¢…ì† ë¶ˆê°€ëŠ¥
- âœ… ëª¨ë“  ë¹„í‚¤ ì†ì„±ì´ ê¸°ë³¸í‚¤ì— ì™„ì „ í•¨ìˆ˜ ì¢…ì†

**ì œ3ì •ê·œí˜• (3NF) ê²€ì¦**:
- âœ… ì´í–‰ í•¨ìˆ˜ ì¢…ì† ì—†ìŒ
- âœ… ëª¨ë“  ë¹„í‚¤ ì†ì„±ì´ ê¸°ë³¸í‚¤ì—ë§Œ ì¢…ì†
- âš ï¸ `realized_pnl`ì€ ê³„ì‚° ì†ì„±ì´ë¯€ë¡œ ì €ì¥í•˜ì§€ ì•ŠìŒ (ì¤‘ë³µ ì œê±°)

**BCNF ê²€ì¦**:
- âœ… ëª¨ë“  ê²°ì •ìê°€ í›„ë³´í‚¤ (trade_idë§Œ ê²°ì •ì)

### 2.3 Phase 2: users í…Œì´ë¸” ìƒì„¸ ì„¤ê³„

#### 2.3.1 í…Œì´ë¸” ë©”íƒ€ë°ì´í„°

| í•­ëª© | ë‚´ìš© |
|------|------|
| **í…Œì´ë¸”ëª…** | users |
| **í…Œì´ë¸” ì„¤ëª…** | ì‹œìŠ¤í…œ ì‚¬ìš©ì ê³„ì • ì •ë³´ |
| **ê¸°ë³¸í‚¤** | user_id |
| **ì™¸ë˜í‚¤** | ì—†ìŒ |
| **ëŒ€ì²´í‚¤** | email (UNIQUE) |

#### 2.3.2 ì»¬ëŸ¼ ì •ì˜

| ì»¬ëŸ¼ëª… | ë°ì´í„° íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|-------|-----------|------|--------|---------|------|
| **user_id** | BIGINT | NOT NULL | AUTO_INCREMENT | PK | ì‚¬ìš©ì ê³ ìœ  ì‹ë³„ì |
| **email** | VARCHAR(100) | NOT NULL | - | UNIQUE, CHECK (email LIKE '%@%') | ì´ë©”ì¼ (ë¡œê·¸ì¸ ID) |
| **password** | VARCHAR(255) | NOT NULL | - | - | ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ |
| **name** | VARCHAR(50) | NOT NULL | - | CHECK (LENGTH(name) > 0) | ì‚¬ìš©ì ì´ë¦„ |
| **joined_at** | DATETIME | NOT NULL | CURRENT_TIMESTAMP | - | ê°€ì… ì¼ì‹œ |
| **last_login_at** | DATETIME | NULL | NULL | - | ìµœê·¼ ë¡œê·¸ì¸ ì¼ì‹œ |
| **created_at** | DATETIME | NOT NULL | CURRENT_TIMESTAMP | - | ë ˆì½”ë“œ ìƒì„± ì¼ì‹œ |
| **updated_at** | DATETIME | NOT NULL | CURRENT_TIMESTAMP ON UPDATE | - | ë ˆì½”ë“œ ìˆ˜ì • ì¼ì‹œ |
| **deleted_at** | DATETIME | NULL | NULL | - | ë…¼ë¦¬ ì‚­ì œ ì¼ì‹œ |

---

## 3. í‚¤(Key) ì •ì˜

### 3.1 í‚¤ì˜ ì¢…ë¥˜

| í‚¤ íƒ€ì… | ì˜ë¬¸ | ì„¤ëª… | í‘œê¸° |
|--------|------|------|------|
| **ê¸°ë³¸í‚¤** | Primary Key | í…Œì´ë¸”ì˜ ê° í–‰ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„ | PK |
| **ì™¸ë˜í‚¤** | Foreign Key | ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ê¸°ë³¸í‚¤ ì°¸ì¡° | FK |
| **ëŒ€ì²´í‚¤** | Alternate Key | ê¸°ë³¸í‚¤ í›„ë³´ì˜€ìœ¼ë‚˜ ì„ íƒë˜ì§€ ì•Šì€ í‚¤ | AK, UK |
| **í›„ë³´í‚¤** | Candidate Key | ê¸°ë³¸í‚¤ê°€ ë  ìˆ˜ ìˆëŠ” ëª¨ë“  í‚¤ | CK |
| **ë³µí•©í‚¤** | Composite Key | 2ê°œ ì´ìƒì˜ ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ì„±ëœ í‚¤ | - |

### 3.2 trades í…Œì´ë¸” í‚¤ ì •ì˜

#### ê¸°ë³¸í‚¤ (Primary Key)
```sql
PRIMARY KEY (trade_id)
```

**ì„ ì • ê·¼ê±°**:
- ì‹œìŠ¤í…œ ìƒì„± ëŒ€ë¦¬í‚¤ (Surrogate Key)
- ë¶ˆë³€ì„± ë³´ì¥ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¬´ê´€)
- ë‹¨ìˆœì„± (ë‹¨ì¼ ì»¬ëŸ¼)
- ì„±ëŠ¥ (ì •ìˆ˜ íƒ€ì…, AUTO_INCREMENT)

**ëŒ€ì•ˆ ê³ ë ¤**:
- âŒ ìì—°í‚¤ (Natural Key): `(symbol, entry_date)` - ë™ì¼ ì¢…ëª© ë™ì‹œ ë§¤ë§¤ ê°€ëŠ¥ì„±
- âŒ UUID: ì„±ëŠ¥ ì €í•˜, ì €ì¥ ê³µê°„ ì¦ê°€

#### í›„ë³´í‚¤ (Candidate Key)
```sql
UNIQUE (trade_id)  -- ì„ íƒëœ ê¸°ë³¸í‚¤
-- ë‹¤ë¥¸ í›„ë³´í‚¤ ì—†ìŒ (ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¹ì„±ìƒ ì¤‘ë³µ ë§¤ë§¤ í—ˆìš©)
```

#### ì¸ë±ìŠ¤ (Index)
```sql
INDEX idx_trades_symbol (symbol)           -- ì¢…ëª©ë³„ ì¡°íšŒ
INDEX idx_trades_entry_date (entry_date)   -- ê¸°ê°„ë³„ ì¡°íšŒ
INDEX idx_trades_deleted_at (deleted_at)   -- ë…¼ë¦¬ ì‚­ì œ í•„í„°ë§
INDEX idx_trades_composite (symbol, entry_date)  -- ë³µí•© ì¡°íšŒ
```

### 3.3 users í…Œì´ë¸” í‚¤ ì •ì˜

#### ê¸°ë³¸í‚¤ (Primary Key)
```sql
PRIMARY KEY (user_id)
```

#### ëŒ€ì²´í‚¤ (Alternate Key)
```sql
UNIQUE KEY uk_users_email (email)
```

**ì„ ì • ê·¼ê±°**:
- ì´ë©”ì¼ì€ ì‚¬ìš©ì ì‹ë³„ì— ì‚¬ìš©ë˜ì§€ë§Œ ë³€ê²½ ê°€ëŠ¥ì„± ìˆìŒ
- ê¸°ë³¸í‚¤ëŠ” ë¶ˆë³€ ëŒ€ë¦¬í‚¤ ì‚¬ìš©
- ì´ë©”ì¼ì€ UNIQUE ì œì•½ì¡°ê±´ìœ¼ë¡œ ì¤‘ë³µ ë°©ì§€

#### ì¸ë±ìŠ¤ (Index)
```sql
INDEX idx_users_email (email)  -- ë¡œê·¸ì¸ ì¡°íšŒ (UNIQUE ì œì•½ì¡°ê±´ìœ¼ë¡œ ìë™ ìƒì„±)
```

### 3.4 Phase 2: trades í…Œì´ë¸” ì™¸ë˜í‚¤ ì¶”ê°€

#### ì™¸ë˜í‚¤ (Foreign Key)
```sql
FOREIGN KEY fk_trades_user (user_id) 
    REFERENCES users(user_id)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
```

**ì°¸ì¡° ë¬´ê²°ì„± ê·œì¹™**:
- **ON DELETE RESTRICT**: ì‚¬ìš©ì ì‚­ì œ ì‹œ ë§¤ë§¤ê°€ ìˆìœ¼ë©´ ì‚­ì œ ë¶ˆê°€
- **ON UPDATE CASCADE**: ì‚¬ìš©ì ID ë³€ê²½ ì‹œ ë§¤ë§¤ì˜ user_idë„ ìë™ ë³€ê²½ (ì‹¤ì œë¡œëŠ” ë°œìƒí•˜ì§€ ì•ŠìŒ)

---

## 4. í•¨ìˆ˜ ì¢…ì†ì„± ë¶„ì„

### 4.1 í•¨ìˆ˜ ì¢…ì†ì„± ë‹¤ì´ì–´ê·¸ë¨ (trades í…Œì´ë¸”)

```
trade_id â†’ symbol
trade_id â†’ entry_price
trade_id â†’ quantity
trade_id â†’ fee
trade_id â†’ reason
trade_id â†’ entry_date
trade_id â†’ exit_price
trade_id â†’ exit_date
trade_id â†’ created_at
trade_id â†’ updated_at
trade_id â†’ deleted_at

ê³„ì‚° ì¢…ì†ì„±:
(exit_price, entry_price, quantity, fee) â†’ realized_pnl
```

### 4.2 ì •ê·œí™” ë‹¨ê³„ë³„ ë¶„ì„

#### ë¹„ì •ê·œí˜• â†’ ì œ1ì •ê·œí˜• (1NF)

**ë¬¸ì œì  (ê°€ìƒ ì‹œë‚˜ë¦¬ì˜¤)**:
ë§Œì•½ í•˜ë‚˜ì˜ ë§¤ë§¤ì— ì—¬ëŸ¬ ì¢…ëª©ì„ ì €ì¥í•œë‹¤ë©´?
```
trade_id | symbols        | prices
1        | AAPL, TSLA     | 150.00, 200.00
```

**í•´ê²°ì±…**:
ê° ì¢…ëª©ì„ ë³„ë„ í–‰ìœ¼ë¡œ ë¶„ë¦¬
```
trade_id | symbol | price
1        | AAPL   | 150.00
2        | TSLA   | 200.00
```

**í˜„ì¬ ìƒíƒœ**: âœ… ì´ë¯¸ 1NF ì¶©ì¡± (ì›ìê°’ë§Œ ì €ì¥)

#### ì œ1ì •ê·œí˜• â†’ ì œ2ì •ê·œí˜• (2NF)

**ë¬¸ì œì  ê²€í† **:
ê¸°ë³¸í‚¤ê°€ ë‹¨ì¼ ì»¬ëŸ¼ (trade_id)ì´ë¯€ë¡œ ë¶€ë¶„ í•¨ìˆ˜ ì¢…ì† ë¶ˆê°€ëŠ¥

**í˜„ì¬ ìƒíƒœ**: âœ… ì´ë¯¸ 2NF ì¶©ì¡±

#### ì œ2ì •ê·œí˜• â†’ ì œ3ì •ê·œí˜• (3NF)

**ë¬¸ì œì  ê²€í† **:
ì´í–‰ í•¨ìˆ˜ ì¢…ì†ì´ ìˆëŠ”ê°€?

ì˜ˆì‹œ: `trade_id â†’ symbol â†’ company_name`
- ë§Œì•½ `company_name` ì»¬ëŸ¼ì´ ìˆë‹¤ë©´ ì´í–‰ ì¢…ì† ë°œìƒ
- í•´ê²°: `stocks` í…Œì´ë¸” ë¶„ë¦¬ (Phase 3ì—ì„œ ê³ ë ¤)

**í˜„ì¬ ìƒíƒœ**: âœ… ì´ë¯¸ 3NF ì¶©ì¡± (company_name ë¯¸ì €ì¥)

#### ì œ3ì •ê·œí˜• â†’ BCNF

**ë¬¸ì œì  ê²€í† **:
ëª¨ë“  ê²°ì •ìê°€ í›„ë³´í‚¤ì¸ê°€?

**í˜„ì¬ ìƒíƒœ**: âœ… BCNF ì¶©ì¡± (trade_idë§Œ ê²°ì •ì)

---

## 5. ë¬´ê²°ì„± ì œì•½ì¡°ê±´

### 5.1 ë¬´ê²°ì„± ì œì•½ì¡°ê±´ì˜ ì¢…ë¥˜

| ë¬´ê²°ì„± íƒ€ì… | ì„¤ëª… | êµ¬í˜„ ë°©ë²• |
|-----------|------|----------|
| **ê°œì²´ ë¬´ê²°ì„±** | ê¸°ë³¸í‚¤ëŠ” NULL ë¶ˆê°€, ê³ ìœ í•´ì•¼ í•¨ | PRIMARY KEY |
| **ì°¸ì¡° ë¬´ê²°ì„±** | ì™¸ë˜í‚¤ëŠ” ì°¸ì¡° í…Œì´ë¸”ì— ì¡´ì¬í•´ì•¼ í•¨ | FOREIGN KEY |
| **ë„ë©”ì¸ ë¬´ê²°ì„±** | ì»¬ëŸ¼ ê°’ì´ ì •ì˜ëœ ë„ë©”ì¸ ë‚´ì— ìˆì–´ì•¼ í•¨ | CHECK, NOT NULL |
| **ì‚¬ìš©ì ì •ì˜ ë¬´ê²°ì„±** | ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê¸°ë°˜ ì œì•½ | CHECK, TRIGGER |

### 5.2 trades í…Œì´ë¸” ë¬´ê²°ì„± ì œì•½ì¡°ê±´

#### 5.2.1 ê°œì²´ ë¬´ê²°ì„± (Entity Integrity)

```sql
-- ê¸°ë³¸í‚¤ ì œì•½ì¡°ê±´
CONSTRAINT pk_trades PRIMARY KEY (trade_id)

-- ê¸°ë³¸í‚¤ëŠ” ìë™ìœ¼ë¡œ NOT NULL, UNIQUE ë³´ì¥
```

#### 5.2.2 ë„ë©”ì¸ ë¬´ê²°ì„± (Domain Integrity)

```sql
-- NOT NULL ì œì•½ì¡°ê±´
trade_id BIGINT NOT NULL
symbol VARCHAR(20) NOT NULL
entry_price DECIMAL(15,2) NOT NULL
quantity INT NOT NULL
fee DECIMAL(10,2) NOT NULL
reason VARCHAR(500) NOT NULL
entry_date DATETIME NOT NULL

-- CHECK ì œì•½ì¡°ê±´
CONSTRAINT chk_trades_entry_price CHECK (entry_price > 0)
CONSTRAINT chk_trades_quantity CHECK (quantity > 0)
CONSTRAINT chk_trades_fee CHECK (fee >= 0)
CONSTRAINT chk_trades_exit_price CHECK (exit_price > 0 OR exit_price IS NULL)
CONSTRAINT chk_trades_exit_date CHECK (exit_date > entry_date OR exit_date IS NULL)
CONSTRAINT chk_trades_symbol CHECK (LENGTH(symbol) > 0)
CONSTRAINT chk_trades_reason CHECK (LENGTH(reason) > 0)
```

#### 5.2.3 ì‚¬ìš©ì ì •ì˜ ë¬´ê²°ì„± (User-Defined Integrity)

```sql
-- ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì²­ì‚° ê°€ê²©ê³¼ ì²­ì‚° ì¼ì‹œëŠ” í•¨ê»˜ ì¡´ì¬í•˜ê±°ë‚˜ í•¨ê»˜ NULL
CONSTRAINT chk_trades_exit_consistency 
    CHECK (
        (exit_price IS NULL AND exit_date IS NULL) OR
        (exit_price IS NOT NULL AND exit_date IS NOT NULL)
    )

-- ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™: ì‚­ì œëœ ë ˆì½”ë“œëŠ” ìˆ˜ì • ë¶ˆê°€ (ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ ì²˜ë¦¬)
```

### 5.3 users í…Œì´ë¸” ë¬´ê²°ì„± ì œì•½ì¡°ê±´

#### 5.3.1 ê°œì²´ ë¬´ê²°ì„±

```sql
CONSTRAINT pk_users PRIMARY KEY (user_id)
```

#### 5.3.2 ë„ë©”ì¸ ë¬´ê²°ì„±

```sql
-- NOT NULL ì œì•½ì¡°ê±´
user_id BIGINT NOT NULL
email VARCHAR(100) NOT NULL
password VARCHAR(255) NOT NULL
name VARCHAR(50) NOT NULL
joined_at DATETIME NOT NULL

-- CHECK ì œì•½ì¡°ê±´
CONSTRAINT chk_users_email CHECK (email LIKE '%@%')
CONSTRAINT chk_users_name CHECK (LENGTH(name) > 0)
```

#### 5.3.3 ëŒ€ì²´í‚¤ ë¬´ê²°ì„±

```sql
CONSTRAINT uk_users_email UNIQUE (email)
```

### 5.4 Phase 2: ì°¸ì¡° ë¬´ê²°ì„± (Referential Integrity)

```sql
-- trades í…Œì´ë¸”ì— user_id ì™¸ë˜í‚¤ ì¶”ê°€
ALTER TABLE trades ADD COLUMN user_id BIGINT NOT NULL;

CONSTRAINT fk_trades_user 
    FOREIGN KEY (user_id) 
    REFERENCES users(user_id)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
```

**ì°¸ì¡° ë¬´ê²°ì„± ê·œì¹™**:
- **ON DELETE RESTRICT**: ì‚¬ìš©ìì—ê²Œ ë§¤ë§¤ê°€ ìˆìœ¼ë©´ ì‚­ì œ ë¶ˆê°€
- **ON UPDATE CASCADE**: ì‚¬ìš©ì ID ë³€ê²½ ì‹œ ë§¤ë§¤ë„ ìë™ ì—…ë°ì´íŠ¸
- **ON DELETE SET NULL**: ì‚¬ìš© ì•ˆ í•¨ (ë§¤ë§¤ëŠ” í•­ìƒ ì†Œìœ ì í•„ìš”)
- **ON DELETE CASCADE**: ì‚¬ìš© ì•ˆ í•¨ (ë°ì´í„° ë³´ì¡´ ì •ì±…)

---

## 6. ì¸ë±ìŠ¤ ì „ëµ

### 6.1 ì¸ë±ìŠ¤ ì„¤ê³„ ì›ì¹™

1. **ì„ íƒë„ (Selectivity)**: ê³ ìœ ê°’ì´ ë§ì€ ì»¬ëŸ¼ ìš°ì„ 
2. **ì¹´ë””ë„ë¦¬í‹° (Cardinality)**: ì¤‘ë³µì´ ì ì€ ì»¬ëŸ¼ ìš°ì„ 
3. **ì¡°íšŒ íŒ¨í„´**: ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤
4. **ì¡°ì¸ ì»¬ëŸ¼**: ì™¸ë˜í‚¤ì— ì¸ë±ìŠ¤
5. **ì •ë ¬/ê·¸ë£¹í™”**: ORDER BY, GROUP BY ì»¬ëŸ¼ì— ì¸ë±ìŠ¤

### 6.2 trades í…Œì´ë¸” ì¸ë±ìŠ¤ ì„¤ê³„

#### 6.2.1 ê¸°ë³¸í‚¤ ì¸ë±ìŠ¤ (ìë™ ìƒì„±)

```sql
-- í´ëŸ¬ìŠ¤í„°ë“œ ì¸ë±ìŠ¤ (InnoDB ê¸°ì¤€)
PRIMARY KEY (trade_id)
```

#### 6.2.2 ë‹¨ì¼ ì»¬ëŸ¼ ì¸ë±ìŠ¤

```sql
-- ì¢…ëª©ë³„ ì¡°íšŒ (SELECT * FROM trades WHERE symbol = 'AAPL')
CREATE INDEX idx_trades_symbol ON trades(symbol);

-- ê¸°ê°„ë³„ ì¡°íšŒ (SELECT * FROM trades WHERE entry_date BETWEEN ... AND ...)
CREATE INDEX idx_trades_entry_date ON trades(entry_date);

-- ë…¼ë¦¬ ì‚­ì œ í•„í„°ë§ (SELECT * FROM trades WHERE deleted_at IS NULL)
CREATE INDEX idx_trades_deleted_at ON trades(deleted_at);
```

#### 6.2.3 ë³µí•© ì¸ë±ìŠ¤ (Composite Index)

```sql
-- ì¢…ëª© + ê¸°ê°„ ì¡°íšŒ (ê°€ì¥ ë¹ˆë²ˆí•œ ì¿¼ë¦¬)
CREATE INDEX idx_trades_symbol_entry_date ON trades(symbol, entry_date);

-- ì²­ì‚° ì—¬ë¶€ + ì§„ì…ì¼ ì¡°íšŒ
CREATE INDEX idx_trades_exit_entry ON trades(exit_price, entry_date);
```

**ë³µí•© ì¸ë±ìŠ¤ ìˆœì„œ ê²°ì •**:
- ì„ íƒë„ê°€ ë†’ì€ ì»¬ëŸ¼ ìš°ì„  (symbol)
- ë²”ìœ„ ê²€ìƒ‰ ì»¬ëŸ¼ì€ ë’¤ì— ë°°ì¹˜ (entry_date)

#### 6.2.4 ì»¤ë²„ë§ ì¸ë±ìŠ¤ (Covering Index)

```sql
-- ì†ìµ ê³„ì‚° ì¿¼ë¦¬ ìµœì í™”
CREATE INDEX idx_trades_pnl_calc 
    ON trades(trade_id, entry_price, exit_price, quantity, fee)
    WHERE exit_price IS NOT NULL;
```

### 6.3 users í…Œì´ë¸” ì¸ë±ìŠ¤ ì„¤ê³„

```sql
-- ê¸°ë³¸í‚¤ ì¸ë±ìŠ¤ (ìë™ ìƒì„±)
PRIMARY KEY (user_id)

-- ì´ë©”ì¼ ì¸ë±ìŠ¤ (UNIQUE ì œì•½ì¡°ê±´ìœ¼ë¡œ ìë™ ìƒì„±)
UNIQUE KEY uk_users_email (email)
```

### 6.4 ì¸ë±ìŠ¤ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

| ì¿¼ë¦¬ íŒ¨í„´ | ì‚¬ìš© ì¸ë±ìŠ¤ | ì„¤ëª… |
|----------|-----------|------|
| `WHERE trade_id = ?` | pk_trades | ê¸°ë³¸í‚¤ ì¡°íšŒ |
| `WHERE symbol = ?` | idx_trades_symbol | ì¢…ëª©ë³„ ì¡°íšŒ |
| `WHERE entry_date BETWEEN ? AND ?` | idx_trades_entry_date | ê¸°ê°„ë³„ ì¡°íšŒ |
| `WHERE symbol = ? AND entry_date BETWEEN ? AND ?` | idx_trades_symbol_entry_date | ë³µí•© ì¡°íšŒ |
| `WHERE deleted_at IS NULL` | idx_trades_deleted_at | í™œì„± ë§¤ë§¤ë§Œ ì¡°íšŒ |
| `WHERE exit_price IS NOT NULL` | idx_trades_exit_entry | ì²­ì‚° ì™„ë£Œ ë§¤ë§¤ ì¡°íšŒ |

---

## 7. ë…¼ë¦¬ì  ERD

### 7.1 Phase 1: MVP ë…¼ë¦¬ì  ERD

```mermaid
erDiagram
    TRADES {
        BIGINT trade_id PK "AUTO_INCREMENT"
        VARCHAR_20 symbol "NOT NULL"
        DECIMAL_15_2 entry_price "NOT NULL, > 0"
        INT quantity "NOT NULL, > 0"
        DECIMAL_10_2 fee "NOT NULL, >= 0, DEFAULT 0"
        VARCHAR_500 reason "NOT NULL"
        DATETIME entry_date "NOT NULL, DEFAULT CURRENT_TIMESTAMP"
        DECIMAL_15_2 exit_price "NULL, > 0"
        DATETIME exit_date "NULL, > entry_date"
        DATETIME created_at "NOT NULL, DEFAULT CURRENT_TIMESTAMP"
        DATETIME updated_at "NOT NULL, ON UPDATE CURRENT_TIMESTAMP"
        DATETIME deleted_at "NULL"
    }
```

### 7.2 Phase 2: User ì¶”ê°€ ë…¼ë¦¬ì  ERD

```mermaid
erDiagram
    USERS ||--o{ TRADES : "owns (1:N)"
    
    USERS {
        BIGINT user_id PK "AUTO_INCREMENT"
        VARCHAR_100 email UK "NOT NULL, UNIQUE"
        VARCHAR_255 password "NOT NULL"
        VARCHAR_50 name "NOT NULL"
        DATETIME joined_at "NOT NULL, DEFAULT CURRENT_TIMESTAMP"
        DATETIME last_login_at "NULL"
        DATETIME created_at "NOT NULL"
        DATETIME updated_at "NOT NULL"
        DATETIME deleted_at "NULL"
    }
    
    TRADES {
        BIGINT trade_id PK "AUTO_INCREMENT"
        BIGINT user_id FK "NOT NULL"
        VARCHAR_20 symbol "NOT NULL"
        DECIMAL_15_2 entry_price "NOT NULL, > 0"
        INT quantity "NOT NULL, > 0"
        DECIMAL_10_2 fee "NOT NULL, >= 0"
        VARCHAR_500 reason "NOT NULL"
        DATETIME entry_date "NOT NULL"
        DECIMAL_15_2 exit_price "NULL"
        DATETIME exit_date "NULL"
        DATETIME created_at "NOT NULL"
        DATETIME updated_at "NOT NULL"
        DATETIME deleted_at "NULL"
    }
```

### 7.3 Phase 3: ì „ì²´ í™•ì¥ ë…¼ë¦¬ì  ERD

```mermaid
erDiagram
    USERS ||--o{ TRADES : owns
    USERS ||--o{ PORTFOLIOS : manages
    PORTFOLIOS ||--o{ TRADES : contains
    TRADES }o--o{ TAGS : "tagged with"
    TRADES ||--o{ ATTACHMENTS : has
    
    USERS {
        BIGINT user_id PK
        VARCHAR_100 email UK
        VARCHAR_255 password
        VARCHAR_50 name
        DATETIME joined_at
        DATETIME last_login_at
        DATETIME created_at
        DATETIME updated_at
        DATETIME deleted_at
    }
    
    TRADES {
        BIGINT trade_id PK
        BIGINT user_id FK
        BIGINT portfolio_id FK
        VARCHAR_20 symbol
        DECIMAL_15_2 entry_price
        INT quantity
        DECIMAL_10_2 fee
        VARCHAR_500 reason
        DATETIME entry_date
        DECIMAL_15_2 exit_price
        DATETIME exit_date
        DATETIME created_at
        DATETIME updated_at
        DATETIME deleted_at
    }
    
    PORTFOLIOS {
        BIGINT portfolio_id PK
        BIGINT user_id FK
        VARCHAR_100 name
        VARCHAR_500 description
        DATETIME created_at
        DATETIME updated_at
        DATETIME deleted_at
    }
    
    TAGS {
        BIGINT tag_id PK
        VARCHAR_50 name UK
        VARCHAR_7 color
        DATETIME created_at
    }
    
    TRADE_TAGS {
        BIGINT trade_id FK
        BIGINT tag_id FK
        DATETIME created_at
    }
    
    ATTACHMENTS {
        BIGINT attachment_id PK
        BIGINT trade_id FK
        VARCHAR_255 file_name
        VARCHAR_500 file_url
        VARCHAR_50 file_type
        BIGINT file_size
        DATETIME uploaded_at
    }
```

---

## 8. ë°ì´í„° ì‚¬ì „ (Data Dictionary)

### 8.1 trades í…Œì´ë¸” ë°ì´í„° ì‚¬ì „

| # | ì»¬ëŸ¼ëª… | í•œê¸€ëª… | íƒ€ì… | ê¸¸ì´ | NULL | ê¸°ë³¸ê°’ | PK | FK | UK | ì„¤ëª… |
|---|-------|-------|------|------|------|--------|----|----|----|----|
| 1 | trade_id | ë§¤ë§¤ID | BIGINT | - | N | AUTO | âœ… | - | - | ë§¤ë§¤ ê³ ìœ  ì‹ë³„ì |
| 2 | symbol | ì¢…ëª©ì½”ë“œ | VARCHAR | 20 | N | - | - | - | - | ê±°ë˜ ì¢…ëª© ì½”ë“œ |
| 3 | entry_price | ì§„ì…ê°€ê²© | DECIMAL | 15,2 | N | - | - | - | - | ë§¤ìˆ˜ ì²´ê²° ê°€ê²© |
| 4 | quantity | ìˆ˜ëŸ‰ | INT | - | N | - | - | - | - | ë§¤ìˆ˜ ì£¼ì‹ ìˆ˜ëŸ‰ |
| 5 | fee | ìˆ˜ìˆ˜ë£Œ | DECIMAL | 10,2 | N | 0.00 | - | - | - | ê±°ë˜ ìˆ˜ìˆ˜ë£Œ |
| 6 | reason | ë§¤ë§¤ê·¼ê±° | VARCHAR | 500 | N | - | - | - | - | ë§¤ë§¤ ì‹¤í–‰ ì´ìœ  |
| 7 | entry_date | ì§„ì…ì¼ì‹œ | DATETIME | - | N | NOW() | - | - | - | ë§¤ìˆ˜ ì²´ê²° ì¼ì‹œ |
| 8 | exit_price | ì²­ì‚°ê°€ê²© | DECIMAL | 15,2 | Y | NULL | - | - | - | ë§¤ë„ ì²´ê²° ê°€ê²© |
| 9 | exit_date | ì²­ì‚°ì¼ì‹œ | DATETIME | - | Y | NULL | - | - | - | ë§¤ë„ ì²´ê²° ì¼ì‹œ |
| 10 | created_at | ìƒì„±ì¼ì‹œ | DATETIME | - | N | NOW() | - | - | - | ë ˆì½”ë“œ ìƒì„± ì‹œê° |
| 11 | updated_at | ìˆ˜ì •ì¼ì‹œ | DATETIME | - | N | NOW() | - | - | - | ë ˆì½”ë“œ ìˆ˜ì • ì‹œê° |
| 12 | deleted_at | ì‚­ì œì¼ì‹œ | DATETIME | - | Y | NULL | - | - | - | ë…¼ë¦¬ ì‚­ì œ ì‹œê° |

### 8.2 users í…Œì´ë¸” ë°ì´í„° ì‚¬ì „

| # | ì»¬ëŸ¼ëª… | í•œê¸€ëª… | íƒ€ì… | ê¸¸ì´ | NULL | ê¸°ë³¸ê°’ | PK | FK | UK | ì„¤ëª… |
|---|-------|-------|------|------|------|--------|----|----|----|----|
| 1 | user_id | ì‚¬ìš©ìID | BIGINT | - | N | AUTO | âœ… | - | - | ì‚¬ìš©ì ê³ ìœ  ì‹ë³„ì |
| 2 | email | ì´ë©”ì¼ | VARCHAR | 100 | N | - | - | - | âœ… | ë¡œê·¸ì¸ ID |
| 3 | password | ë¹„ë°€ë²ˆí˜¸ | VARCHAR | 255 | N | - | - | - | - | ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ |
| 4 | name | ì´ë¦„ | VARCHAR | 50 | N | - | - | - | - | ì‚¬ìš©ì ì´ë¦„ |
| 5 | joined_at | ê°€ì…ì¼ì‹œ | DATETIME | - | N | NOW() | - | - | - | íšŒì›ê°€ì… ì¼ì‹œ |
| 6 | last_login_at | ìµœê·¼ë¡œê·¸ì¸ | DATETIME | - | Y | NULL | - | - | - | ìµœê·¼ ë¡œê·¸ì¸ ì¼ì‹œ |
| 7 | created_at | ìƒì„±ì¼ì‹œ | DATETIME | - | N | NOW() | - | - | - | ë ˆì½”ë“œ ìƒì„± ì‹œê° |
| 8 | updated_at | ìˆ˜ì •ì¼ì‹œ | DATETIME | - | N | NOW() | - | - | - | ë ˆì½”ë“œ ìˆ˜ì • ì‹œê° |
| 9 | deleted_at | ì‚­ì œì¼ì‹œ | DATETIME | - | Y | NULL | - | - | - | ë…¼ë¦¬ ì‚­ì œ ì‹œê° |

---

## 9. ë·°(View) ì„¤ê³„

### 9.1 ë·° ì„¤ê³„ ëª©ì 

- ë³µì¡í•œ ì¿¼ë¦¬ ë‹¨ìˆœí™”
- ë³´ì•ˆ (íŠ¹ì • ì»¬ëŸ¼ ìˆ¨ê¹€)
- ë°ì´í„° ì¶”ìƒí™”
- ê³„ì‚° ì†ì„± ì œê³µ

### 9.2 active_trades ë·°

**ëª©ì **: ë…¼ë¦¬ ì‚­ì œë˜ì§€ ì•Šì€ í™œì„± ë§¤ë§¤ë§Œ ì¡°íšŒ

```sql
CREATE VIEW v_active_trades AS
SELECT 
    trade_id,
    symbol,
    entry_price,
    quantity,
    fee,
    reason,
    entry_date,
    exit_price,
    exit_date,
    -- ê³„ì‚° ì†ì„±
    CASE 
        WHEN exit_price IS NOT NULL THEN
            (exit_price * quantity) - (entry_price * quantity) - fee
        ELSE NULL
    END AS realized_pnl,
    -- íˆ¬ì ê¸ˆì•¡
    entry_price * quantity AS investment_amount,
    -- ìˆ˜ìµë¥ 
    CASE 
        WHEN exit_price IS NOT NULL THEN
            (((exit_price * quantity) - (entry_price * quantity) - fee) / (entry_price * quantity)) * 100
        ELSE NULL
    END AS return_rate,
    created_at,
    updated_at
FROM trades
WHERE deleted_at IS NULL;
```

### 9.3 closed_trades ë·°

**ëª©ì **: ì²­ì‚° ì™„ë£Œëœ ë§¤ë§¤ë§Œ ì¡°íšŒ

```sql
CREATE VIEW v_closed_trades AS
SELECT 
    trade_id,
    symbol,
    entry_price,
    quantity,
    fee,
    reason,
    entry_date,
    exit_price,
    exit_date,
    (exit_price * quantity) - (entry_price * quantity) - fee AS realized_pnl,
    entry_price * quantity AS investment_amount,
    (((exit_price * quantity) - (entry_price * quantity) - fee) / (entry_price * quantity)) * 100 AS return_rate,
    DATEDIFF(exit_date, entry_date) AS holding_days
FROM trades
WHERE deleted_at IS NULL
  AND exit_price IS NOT NULL
  AND exit_date IS NOT NULL;
```

### 9.4 trade_statistics ë·°

**ëª©ì **: ë§¤ë§¤ í†µê³„ ìš”ì•½

```sql
CREATE VIEW v_trade_statistics AS
SELECT 
    COUNT(*) AS total_trades,
    SUM(CASE WHEN exit_price IS NOT NULL THEN 1 ELSE 0 END) AS closed_trades,
    SUM(CASE WHEN exit_price IS NULL THEN 1 ELSE 0 END) AS open_trades,
    SUM(CASE 
        WHEN exit_price IS NOT NULL THEN
            (exit_price * quantity) - (entry_price * quantity) - fee
        ELSE 0
    END) AS total_realized_pnl,
    AVG(CASE 
        WHEN exit_price IS NOT NULL THEN
            (exit_price * quantity) - (entry_price * quantity) - fee
        ELSE NULL
    END) AS avg_realized_pnl,
    SUM(CASE 
        WHEN exit_price IS NOT NULL AND (exit_price * quantity) - (entry_price * quantity) - fee > 0 THEN 1
        ELSE 0
    END) AS winning_trades,
    SUM(CASE 
        WHEN exit_price IS NOT NULL AND (exit_price * quantity) - (entry_price * quantity) - fee <= 0 THEN 1
        ELSE 0
    END) AS losing_trades,
    CASE 
        WHEN SUM(CASE WHEN exit_price IS NOT NULL THEN 1 ELSE 0 END) > 0 THEN
            (SUM(CASE 
                WHEN exit_price IS NOT NULL AND (exit_price * quantity) - (entry_price * quantity) - fee > 0 THEN 1
                ELSE 0
            END) * 100.0 / SUM(CASE WHEN exit_price IS NOT NULL THEN 1 ELSE 0 END))
        ELSE 0
    END AS win_rate
FROM trades
WHERE deleted_at IS NULL;
```

---

## 10. ë…¼ë¦¬ì  ëª¨ë¸ ê²€ì¦

### 10.1 ì •ê·œí™” ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… **1NF**: ëª¨ë“  ì†ì„±ì´ ì›ìê°’
- âœ… **2NF**: ë¶€ë¶„ í•¨ìˆ˜ ì¢…ì† ì œê±°
- âœ… **3NF**: ì´í–‰ í•¨ìˆ˜ ì¢…ì† ì œê±°
- âœ… **BCNF**: ëª¨ë“  ê²°ì •ìê°€ í›„ë³´í‚¤

### 10.2 ë¬´ê²°ì„± ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… **ê°œì²´ ë¬´ê²°ì„±**: ëª¨ë“  í…Œì´ë¸”ì— ê¸°ë³¸í‚¤ ì •ì˜
- âœ… **ì°¸ì¡° ë¬´ê²°ì„±**: ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ ì •ì˜ (Phase 2)
- âœ… **ë„ë©”ì¸ ë¬´ê²°ì„±**: CHECK ì œì•½ì¡°ê±´ ì •ì˜
- âœ… **ì‚¬ìš©ì ì •ì˜ ë¬´ê²°ì„±**: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ë°˜ì˜

### 10.3 ì„±ëŠ¥ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… **ì¸ë±ìŠ¤**: ì¡°íšŒ íŒ¨í„´ì— ë§ëŠ” ì¸ë±ìŠ¤ ì„¤ê³„
- âœ… **ë³µí•© ì¸ë±ìŠ¤**: ë¹ˆë²ˆí•œ ë³µí•© ì¡°íšŒ ìµœì í™”
- âš ï¸ **íŒŒí‹°ì…”ë‹**: í–¥í›„ ë°ì´í„° ì¦ê°€ ì‹œ ê³ ë ¤
- âš ï¸ **ë¹„ì •ê·œí™”**: ì„±ëŠ¥ ì´ìŠˆ ë°œìƒ ì‹œ ê³ ë ¤

---

## 11. ë‹¤ìŒ ë‹¨ê³„ (4ë‹¨ê³„: ë¬¼ë¦¬ì  ëª¨ë¸ë§)

ë…¼ë¦¬ì  ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1. **DBMS ì„ ì •**: H2 (ê°œë°œ), MySQL (ìš´ì˜)
2. **ë¬¼ë¦¬ì  DDL ì‘ì„±**: ì‹¤ì œ ì‹¤í–‰ ê°€ëŠ¥í•œ CREATE TABLE ìŠ¤í¬ë¦½íŠ¸
3. **ìŠ¤í† ë¦¬ì§€ ì„¤ê³„**: í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤, íŒŒí‹°ì…”ë‹
4. **ì„±ëŠ¥ íŠœë‹**: ì¿¼ë¦¬ ìµœì í™”, ì‹¤í–‰ ê³„íš ë¶„ì„
5. **ë°±ì—…/ë³µêµ¬ ì „ëµ**: ë°±ì—… ì£¼ê¸°, ë³µêµ¬ ì ˆì°¨

---

## ë¶€ë¡ A: SQL ìŠ¤í¬ë¦½íŠ¸ (ë…¼ë¦¬ì  ìŠ¤í‚¤ë§ˆ)

### A.1 trades í…Œì´ë¸” ìƒì„± (ë…¼ë¦¬ì )

```sql
CREATE TABLE trades (
    trade_id BIGINT NOT NULL AUTO_INCREMENT,
    symbol VARCHAR(20) NOT NULL,
    entry_price DECIMAL(15,2) NOT NULL,
    quantity INT NOT NULL,
    fee DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    reason VARCHAR(500) NOT NULL,
    entry_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    exit_price DECIMAL(15,2) NULL,
    exit_date DATETIME NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at DATETIME NULL,
    
    CONSTRAINT pk_trades PRIMARY KEY (trade_id),
    CONSTRAINT chk_trades_entry_price CHECK (entry_price > 0),
    CONSTRAINT chk_trades_quantity CHECK (quantity > 0),
    CONSTRAINT chk_trades_fee CHECK (fee >= 0),
    CONSTRAINT chk_trades_exit_price CHECK (exit_price > 0 OR exit_price IS NULL),
    CONSTRAINT chk_trades_exit_date CHECK (exit_date > entry_date OR exit_date IS NULL),
    CONSTRAINT chk_trades_symbol CHECK (LENGTH(symbol) > 0),
    CONSTRAINT chk_trades_reason CHECK (LENGTH(reason) > 0),
    CONSTRAINT chk_trades_exit_consistency CHECK (
        (exit_price IS NULL AND exit_date IS NULL) OR
        (exit_price IS NOT NULL AND exit_date IS NOT NULL)
    )
);

CREATE INDEX idx_trades_symbol ON trades(symbol);
CREATE INDEX idx_trades_entry_date ON trades(entry_date);
CREATE INDEX idx_trades_deleted_at ON trades(deleted_at);
CREATE INDEX idx_trades_symbol_entry_date ON trades(symbol, entry_date);
```

### A.2 users í…Œì´ë¸” ìƒì„± (ë…¼ë¦¬ì )

```sql
CREATE TABLE users (
    user_id BIGINT NOT NULL AUTO_INCREMENT,
    email VARCHAR(100) NOT NULL,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(50) NOT NULL,
    joined_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_login_at DATETIME NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at DATETIME NULL,
    
    CONSTRAINT pk_users PRIMARY KEY (user_id),
    CONSTRAINT uk_users_email UNIQUE (email),
    CONSTRAINT chk_users_email CHECK (email LIKE '%@%'),
    CONSTRAINT chk_users_name CHECK (LENGTH(name) > 0)
);
```

---

## ë¶€ë¡ B: ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ì‘ì„±ì | ë³€ê²½ ë‚´ìš© |
|------|------|--------|----------|
| 1.0 | 2025-11-23 | Database Design Team | ì´ˆì•ˆ ì‘ì„± |

---

**ë¬¸ì„œ ë**
